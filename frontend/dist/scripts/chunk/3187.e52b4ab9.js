"use strict";(self.webpackChunktestAmis=self.webpackChunktestAmis||[]).push([[3187],{33187:function(e,t,n){n.r(t),n.d(t,{TreeControlRenderer:function(){return y},default:function(){return f}});var i=n(31635),o=n(96540),r=n(90179),l=n.n(r),a=n(38221),s=n.n(a),d=n(32485),p=n.n(d),u=n(51545),c=n(65408),h=n(41376),v=n(8096),m=n(66283),f=function(e){function t(t){var n,i=this;return(i=e.call(this,t)||this).state={keyword:"",filteredOptions:null!==(n=i.props.options)&&void 0!==n?n:[]},i.handleSearch=s()(i.handleSearch.bind(i),250,{trailing:!0,leading:!1}),i}return(0,i.C6)(t,e),t.prototype.componentDidUpdate=function(e){var t=this.props,n=this.state.keyword;if(e.options!==t.options||e.searchable!==t.searchable){var i=t.options,o=t.searchable;this.setState({filteredOptions:o&&n?this.filterOptions(i,n):i})}},t.prototype.reload=function(){var e=this.props.reloadOptions;e&&e()},t.prototype.doAction=function(e,t,n){var i,o,r,l,a,s,d,p,u=null==e?void 0:e.actionType,c=this.props,h=c.resetValue,m=c.onChange,f=c.formStore,y=c.store,g=c.name;if("clear"===u)null==m||m("");else if("reset"===u){var b=null!==(o=(0,v.dnO)(null!==(i=null==f?void 0:f.pristine)&&void 0!==i?i:null==y?void 0:y.pristine,g))&&void 0!==o?o:h;null==m||m(null!=b?b:"")}else"expand"===e.actionType?this.treeRef.syncUnFolded(this.props,null===(r=e.args)||void 0===r?void 0:r.openLevel):"collapse"===e.actionType?this.treeRef.syncUnFolded(this.props,0):"add"===e.actionType?this.addItemFromAction(null===(l=e.args)||void 0===l?void 0:l.item,null===(a=e.args)||void 0===a?void 0:a.parentValue):"edit"===e.actionType?this.editItemFromAction(null===(s=e.args)||void 0===s?void 0:s.item,null===(d=e.args)||void 0===d?void 0:d.originValue):"delete"===e.actionType?this.deleteItemFromAction(null===(p=e.args)||void 0===p?void 0:p.value):"reload"===e.actionType&&this.reload()},t.prototype.resolveOption=function(e,t){var n=this;return(0,v.cym)(e,(function(e){var i=n.props.valueField||"value";return((0,v.Bdw)(e,i)?e[i]:"")===t}))},t.prototype.addItemFromAction=function(e,t){var n=this.props,i=n.onAdd,o=n.options,r=n.valueField,l=(0,v.iXH)(o,(function(e){var n=r||"value";return((0,v.Bdw)(e,n)?e[n]:"")===t}))||[];i&&i(l.concat(0),e,!0)},t.prototype.editItemFromAction=function(e,t){var n=this.props,o=n.onEdit,r=n.options,l=this.resolveOption(r,t);o&&l&&o((0,i.Cl)((0,i.Cl)({},e),{originValue:t}),l,!0)},t.prototype.deleteItemFromAction=function(e){var t=this.props,n=t.onDelete,i=t.options,o=this.resolveOption(i,e);n&&o&&n(o)},t.prototype.filterOptions=function(e,t){var n=this,o=this.props,r=o.labelField,l=o.valueField;return e.map((function(e){if((e=(0,i.Cl)({},e)).visible=!!(0,u.Ht)([e],t,{keys:[r||"label",l||"value"],threshold:u.Ht.rankings.CONTAINS}).length,!e.visible&&e.children){e.children=n.filterOptions(e.children,t);var o=e.children.filter((function(e){return e.visible})).length;e.visible=!!o}return e.visible&&(e.collapsed=!1),e}))},t.prototype.handleChange=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,o,r,l,a,s,d,p,u,c,m,f,y,g,b;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return t=this.props,n=t.onChange,o=t.searchable,r=t.options,l=t.dispatchEvent,a=t.multiple,s=t.delimiter,d=t.valueField,p=t.selectedOptions,u=t.joinValues,c=t.extractValue,m=this.state.filteredOptions,f=o?m:r,y=(0,h.R2)(e,{multiple:a,delimiter:s,valueField:d,options:m}),g=a?null:y[0],a&&o&&p.length&&(p.forEach((function(e){var t=(0,v.cym)(m,(function(t){return t[d||"value"]===e[d||"value"]}));t||y.push(e)})),e=y.map((function(e){return c||u?e[d||"value"]:e})),u&&(e=e.join(s||","))),[4,l("change",(0,v.RKM)(this.props,{value:e,item:g,items:f,selectedItems:y}))];case 1:return(null==(b=i.sent())?void 0:b.prevented)||n&&n(e),[2]}}))}))},t.prototype.handleSearch=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,o,r,l,a,s,d,p,u;return(0,i.YH)(this,(function(i){switch(i.label){case 0:if(t=this.props,n=t.searchApi,o=t.options,r=t.env,l=t.data,a=t.translate,s=[],!(0,v.Amo)(n))return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,r.fetcher(n,(0,v.ed2)(l,{term:e}))];case 2:if(!(d=i.sent()).ok)throw new Error(a(d.msg||"networkError"));if(p=d.data.options||d.data.items||d.data,!Array.isArray(p))throw new Error(a("Tree.invalidArray"));return s=p,[3,4];case 3:return u=i.sent(),r.isCancel(u)||!n.silent&&r.notify("error",u.message),[3,4];case 4:return[3,6];case 5:e&&(s=this.filterOptions(o,e)),i.label=6;case 6:return this.setState({keyword:e,filteredOptions:e?s:o}),[2]}}))}))},t.prototype.domRef=function(e){this.treeRef=e},t.prototype.validate=function(){var e=this.props,t=e.value,n=e.minLength,i=e.maxLength,o=e.delimiter,r=Array.isArray(t)?t:(t?String(t):"").split(o||",");return n&&r.length<n?"已选择数量低于设定的最小个数".concat(n,"，请选择更多的选项。"):i&&r.length>i?"已选择数量超出设定的最大个数".concat(i,"，请取消选择超出的选项。"):void 0},t.prototype.renderOptionItem=function(e,t){var n=this.props,o=n.menuTpl,r=n.render,l=n.data;return r("option/".concat(t.index),o,{data:(0,v.ed2)((0,v.ed2)(l,(0,i.Cl)({},t)),e)})},t.prototype.render=function(){var e=this.props,t=e.className;e.style;var n=e.treeContainerClassName,r=e.classPrefix,a=e.value,s=e.enableNodePath,d=e.pathSeparator,u=void 0===d?"/":d,h=e.disabled,m=e.joinValues,f=e.extractValue,y=e.delimiter,g=e.placeholder,b=e.options,C=e.multiple,O=e.valueField,F=e.initiallyOpen,S=e.unfoldedLevel,T=e.withChildren,A=e.onlyChildren,I=e.onlyLeaf,w=e.loading,k=e.hideRoot,R=e.rootLabel,E=e.autoCheckChildren,j=e.cascade,x=e.rootValue,V=e.showIcon,L=e.showRadio,H=e.showOutline,N=e.onAdd,D=e.creatable,P=e.createTip,U=e.addControls,B=e.onEdit,z=e.editable,G=e.editTip,Y=e.editControls,q=e.removable,K=e.removeTip,M=e.onDelete,Q=e.rootCreatable,X=e.rootCreateTip,$=e.labelField,J=e.iconField,W=e.deferField,Z=e.nodePath,_=e.deferLoad,ee=e.expandTreeOptions,te=e.translate,ne=e.data,ie=e.virtualThreshold,oe=e.itemHeight,re=e.loadingConfig,le=e.menuTpl,ae=e.enableDefaultIcon,se=e.searchable,de=e.searchConfig,pe=void 0===de?{}:de,ue=e.heightAuto,ce=e.mobileUI,he=e.testIdBuilder;e.popOverContainer,e.env;var ve=this.props.highlightTxt,me=this.state,fe=me.filteredOptions,ye=me.keyword;(0,v.joH)(ve)&&(ve=(0,v.GvO)(ve,ne));var ge=o.createElement(c.PH,{classPrefix:r,onRef:this.domRef,labelField:$,valueField:O,iconField:J,deferField:W,disabled:h,onChange:this.handleChange,joinValues:m,extractValue:f,delimiter:y,placeholder:te(g),options:se?fe:b,highlightTxt:se?ye:ve,multiple:C,initiallyOpen:F,unfoldedLevel:S,withChildren:T,onlyChildren:A,onlyLeaf:I,hideRoot:k,rootLabel:te(R),rootValue:x,showIcon:V,showRadio:L,showOutline:H,autoCheckChildren:E,cascade:j,foldedField:"collapsed",value:a||"",nodePath:Z,enableNodePath:s,pathSeparator:u,selfDisabledAffectChildren:!1,onAdd:N,creatable:D,createTip:P,rootCreatable:Q,rootCreateTip:X,onEdit:B,editable:z,editTip:G,removable:q,removeTip:K,onDelete:M,bultinCUD:!U&&!Y,onDeferLoad:_,onExpandTree:ee,virtualThreshold:ie,itemHeight:(0,v.Roz)(oe)>0?(0,v.Roz)(oe):void 0,itemRender:le?this.renderOptionItem:void 0,enableDefaultIcon:ae,mobileUI:ce,testIdBuilder:null==he?void 0:he.getChild("tree")});return o.createElement("div",(0,i.Cl)({className:p()("".concat(r,"TreeControl"),t,n,{"is-sticky":se&&(null==pe?void 0:pe.sticky),"h-auto":ue})},null==he?void 0:he.getChild("control").getTestId()),o.createElement(c.y$,{size:"sm",key:"info",show:w,loadingConfig:re}),w?null:se?o.createElement(o.Fragment,null,o.createElement(c.Gd,(0,i.Cl)({className:p()("".concat(r,"TreeControl-searchbox"),null==pe?void 0:pe.className,{"is-sticky":null==pe?void 0:pe.sticky}),mini:!1,clearable:!0},l()(pe,"className","sticky"),{onSearch:this.handleSearch,mobileUI:ce,testIdBuilder:null==he?void 0:he.getChild("search")})),ge):ge)},t.defaultProps={placeholder:"placeholder.noData",multiple:!1,rootLabel:"Tree.root",rootValue:"",showIcon:!0,enableNodePath:!1,pathSeparator:"/"},(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object,Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"addItemFromAction",null),(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object,Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"editItemFromAction",null),(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"deleteItemFromAction",null),(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",Promise)],t.prototype,"handleChange",null),(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"domRef",null),(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object,Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"renderOptionItem",null),(0,i.Cg)([(0,m.E)(),(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"render",null),t}(o.Component),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.C6)(t,e),(0,i.Cg)([(0,v.QqA)({type:"input-tree"})],t)}(f)}}]);