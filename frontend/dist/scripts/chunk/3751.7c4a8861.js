"use strict";(self.webpackChunktestAmis=self.webpackChunktestAmis||[]).push([[3751],{13751:function(e,o,t){t.r(o),t.d(o,{DrawerRenderer:function(){return p},default:function(){return c}});var n=t(31635),r=t(96540),a=t(8096),s=t(65408),i=t(22451),l=t(40961),d=t(50346),c=function(e){function o(o){var t=e.call(this,o)||this;t.$$id=(0,a.OsD)(),o.store.setEntered(!!o.show),t.handleSelfClose=t.handleSelfClose.bind(t),t.handleAction=t.handleAction.bind(t),t.handleActionSensor=t.handleActionSensor.bind(t),t.handleDrawerConfirm=t.handleDrawerConfirm.bind(t),t.handleDrawerClose=t.handleDrawerClose.bind(t),t.handleDialogConfirm=t.handleDialogConfirm.bind(t),t.handleDialogClose=t.handleDialogClose.bind(t),t.handleChildFinished=t.handleChildFinished.bind(t),t.handleEntered=t.handleEntered.bind(t),t.handleExited=t.handleExited.bind(t),t.handleFormInit=t.handleFormInit.bind(t),t.handleFormChange=t.handleFormChange.bind(t),t.handleFormSaved=t.handleFormSaved.bind(t);var n=o.store;return t.reaction=(0,i.mJ)((function(){return"".concat(n.loading).concat(n.error)}),(function(){return t.forceUpdate()})),t}return(0,n.C6)(o,e),o.prototype.componentWillUnmount=function(){this.reaction&&this.reaction(),clearTimeout(this.clearErrorTimer)},o.prototype.buildActions=function(){var e=this.props,o=e.actions,t=e.confirm,n=e.translate,r=e.testIdBuilder;if(void 0!==o)return o;var a=[];return a.push({type:"button",testIdBuilder:null==r?void 0:r.getChild("cancel"),actionType:"close",label:n("cancel")}),t&&a.push({type:"button",actionType:"confirm",testIdBuilder:null==r?void 0:r.getChild("confirm"),label:n("confirm"),primary:!0}),a},o.prototype.handleSelfClose=function(){return(0,n.sH)(this,void 0,void 0,(function(){var e,o,t,r,a;return(0,n.YH)(this,(function(n){switch(n.label){case 0:return e=this.props,o=e.onClose,t=e.store,r=e.dispatchEvent,!1!==t.dialogOpen||!1!==t.drawerOpen?[2]:[4,r("cancel",this.props.data)];case 1:return(null==(a=n.sent())?void 0:a.prevented)?[2]:(null==a?void 0:a.pendingPromise.length)?[4,a.allDone()]:[3,3];case 2:n.sent(),n.label=3;case 3:return t.updateMessage(),o(),[2]}}))}))},o.prototype.handleActionSensor=function(e){var o=this.props.store,t=o.busying;o.markBusying(!0),o.updateMessage(),e.then((function(){o.markBusying(t)})).catch((function(e){o.updateMessage(e.message,!0),o.markBusying(t)}))},o.prototype.handleAction=function(e,o,t){var n=this.props,r=n.onClose,a=n.onAction;"close"===o.actionType||"cancel"===o.actionType?r():a&&a(e,o,t)},o.prototype.handleDrawerConfirm=function(e,o){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var a=this.props.store;o.mergeData&&1===e.length&&e[0]&&a.updateData(e[0]);var s=a.action.drawer;s.onConfirm&&!1===s.onConfirm.apply(s,(0,n.fX)([e,o],(0,n.zs)(t),!1))||a.closeDrawer(!0,e)},o.prototype.handleDrawerClose=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var t=this.props.store,r=t.action.drawer;r.onClose&&!1===r.onClose.apply(r,(0,n.fX)([],(0,n.zs)(e),!1))||t.closeDrawer.apply(t,(0,n.fX)([],(0,n.zs)(e),!1))},o.prototype.handleDialogConfirm=function(e,o){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var a=this.props.store;o.mergeData&&1===e.length&&e[0]&&a.updateData(e[0]);var s=a.action.dialog;s.onConfirm&&!1===s.onConfirm.apply(s,(0,n.fX)([e,o],(0,n.zs)(t),!1))||a.closeDialog(!0,e)},o.prototype.handleDialogClose=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var t=this.props.store,r=t.action.dialog;r.onClose&&!1===r.onClose.apply(r,(0,n.fX)([],(0,n.zs)(e),!1))||t.closeDialog(e[1])},o.prototype.handleChildFinished=function(e,o){},o.prototype.handleFormInit=function(e){this.props.store.setFormData(e)},o.prototype.handleFormChange=function(e,o){var t=this.props.store;"string"!=typeof o?t.setFormData(e):t.changeValue(o,e)},o.prototype.handleFormSaved=function(e,o){this.props.store.setFormData((0,n.Cl)((0,n.Cl)({},e),o))},o.prototype.handleEntered=function(){var e=this.props,o=e.lazySchema,t=e.store;t.setEntered(!0),t.markBusying(!1),"function"==typeof o&&t.setSchema(o(this.props))},o.prototype.handleExited=function(){var e=this.props,o=e.lazySchema,t=e.store,n=e.statusStore;n&&(0,d._n)(n)&&n.resetAll(),(0,d._n)(t)&&(t.reset(),t.clearMessage(),t.markBusying(!1),t.setEntered(!1),"function"==typeof o&&t.setSchema(""))},o.prototype.getPopOverContainer=function(){return(0,l.findDOMNode)(this).querySelector(".".concat(this.props.classPrefix,"Drawer-content"))},o.prototype.renderBody=function(e,o){var t=this,r=this.props,a=r.render,s=r.store;if(Array.isArray(e))return e.map((function(e,o){return t.renderBody(e,o)}));var i=e,l={key:o,disabled:s.loading,onAction:this.handleAction,onFinished:this.handleChildFinished,popOverContainer:this.getPopOverContainer,onChange:this.handleFormChange,onInit:this.handleFormInit,onSaved:this.handleFormSaved,onActionSensor:this.handleActionSensor,btnDisabled:s.loading,syncLocation:!1};return"form"===i.type&&(i=(0,n.Cl)({mode:"horizontal",wrapWithPanel:!1,submitText:null},i)),a("body".concat(o?"/".concat(o):""),i,l)},o.prototype.renderFooter=function(){var e=this,o=this.buildActions(),t=this.props.hideActions;if(!o||!o.length||t)return null;var i=this.props,l=i.store,d=i.render,c=i.env,p=i.classnames,h=i.showErrorMsg,u=i.footerClassName,m=i.id,f=i.themeCss;return r.createElement("div",{className:p("Drawer-footer",u,(0,a.NH8)((0,n.Cl)((0,n.Cl)({},this.props),{name:"drawerFooterClassName",id:m,themeCss:f})))},l.loading||l.error?r.createElement("div",{className:p("Drawer-info")},r.createElement(s.y$,{size:"sm",key:"info",show:l.loading}),!c.forceSilenceInsideError&&h&&l.error?r.createElement("span",{className:p("Drawer-error")},l.msg):null):null,o.map((function(o,t){return d("action/".concat(t),o,{onAction:e.handleAction,onActionSensor:void 0,btnDisabled:l.loading,data:l.formData,key:t,disabled:o.disabled||l.loading})})))},o.prototype.openFeedback=function(e,o){var t=this;return new Promise((function(n){var r=t.props.store;r.setCurrentAction({type:"button",actionType:"dialog",dialog:e},t.props.resolveDefinitions),r.openDialog(o,void 0,(function(e){n(e)}),t.context)}))},o.prototype.render=function(){var e=this.props.store,o=(0,n.Cl)((0,n.Cl)({},this.props),e.schema),t=o.className,i=o.style,l=o.size,d=o.closeOnEsc,c=o.position,p=o.title,h=o.render,u=o.header,m=o.body,f=o.bodyClassName,C=o.headerClassName,g=o.show,y=o.showCloseButton,v=o.width,w=o.height,D=o.wrapperComponent,b=o.env,N=o.resizable,A=o.overlay,E=o.closeOnOutside,S=o.classPrefix,T=o.classnames,O=o.drawerContainer,k=o.loadingConfig;o.popOverContainer;var x=o.themeCss,F=o.id,z=(0,n.Tt)(o,["className","style","size","closeOnEsc","position","title","render","header","body","bodyClassName","headerClassName","show","showCloseButton","width","height","wrapperComponent","env","resizable","overlay","closeOnOutside","classPrefix","classnames","drawerContainer","loadingConfig","popOverContainer","themeCss","id"]),B=D||s._s;return r.createElement(B,(0,n.Cl)({},z,{resizable:N,classPrefix:S,className:t,style:i,drawerClassName:(0,a.NH8)((0,n.Cl)((0,n.Cl)({},this.props),{name:"drawerClassName",id:F,themeCss:x})),drawerMaskClassName:(0,a.NH8)((0,n.Cl)((0,n.Cl)({},this.props),{name:"drawerMaskClassName",id:F,themeCss:x})),size:l,onHide:this.handleSelfClose,disabled:e.loading,show:g,showCloseButton:y,width:v,height:w,position:c,overlay:A,onEntered:this.handleEntered,onExited:this.handleExited,closeOnEsc:d,closeOnOutside:!e.drawerOpen&&!e.dialogOpen&&E,container:O||(null==b?void 0:b.getModalContainer)}),p||u?r.createElement("div",{className:T("Drawer-header",C,(0,a.NH8)((0,n.Cl)((0,n.Cl)({},this.props),{name:"drawerHeaderClassName",id:F,themeCss:x})))},p?r.createElement("div",{className:T("Drawer-title",(0,a.NH8)((0,n.Cl)((0,n.Cl)({},this.props),{name:"drawerTitleClassName",id:F,themeCss:x})))},h("title",p,{data:e.formData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:e.loading})):null,u?h("header",u,{data:e.formData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:e.loading}):null):null,e.entered?m?r.createElement("div",{className:T("Drawer-body",f,(0,a.NH8)((0,n.Cl)((0,n.Cl)({},this.props),{name:"drawerBodyClassName",id:F,themeCss:x}))),role:"dialog-body"},this.renderBody(m,"body"),r.createElement(a.z4D,(0,n.Cl)({},this.props,{config:{themeCss:x,classNames:[{key:"drawerClassName"},{key:"drawerMaskClassName"},{key:"drawerHeaderClassName"},{key:"drawerTitleClassName"},{key:"drawerBodyClassName"},{key:"drawerFooterClassName"}],id:F},env:b}))):null:r.createElement("div",{className:T("Drawer-body",f,(0,a.NH8)((0,n.Cl)((0,n.Cl)({},this.props),{name:"drawerBodyClassName",id:F,themeCss:x})))},r.createElement(s.y$,{overlay:!0,show:!0,size:"lg",loadingConfig:k})),this.renderFooter(),m?h("dialog",(0,n.Cl)((0,n.Cl)({},e.action&&e.action.dialog),{type:"dialog"}),{key:"dialog",data:e.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,onAction:this.handleAction,show:e.dialogOpen}):null,m?h("drawer",(0,n.Cl)((0,n.Cl)({},e.action&&e.action.drawer),{type:"drawer"}),{key:"drawer",data:e.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,onAction:this.handleAction,show:e.drawerOpen}):null)},o.propsList=["title","size","closeOnEsc","closeOnOutside","children","className","bodyClassName","headerClassName","footerClassName","confirm","position","onClose","onConfirm","show","showCloseButton","width","height","resizable","overlay","body","popOverContainer","showErrorMsg"],o.defaultProps={title:"",className:"",bodyClassName:"",headerClassName:"",footerClassName:"",confirm:!0,position:"right",resizable:!1,showCloseButton:!0,overlay:!0,closeOnEsc:!1,closeOnOutside:!1,showErrorMsg:!0},(0,n.Cg)([a.d6t,(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[]),(0,n.Sn)("design:returntype",void 0)],o.prototype,"getPopOverContainer",null),o}(r.Component),p=function(e){function o(o,t){var n=e.call(this,o)||this;return t.registerComponent(n),n}return(0,n.C6)(o,e),o.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),e.prototype.componentWillUnmount.call(this)},o.prototype.tryChildrenToHandle=function(e,o,t){var r=this,a=this.context,s=[],i=this.props,l=i.onConfirm,d=i.store;if(e.target&&s.push.apply(s,(0,n.fX)([],(0,n.zs)(e.target.split(",").map((function(e){return a.getComponentByName(e)})).filter((function(e){return e&&e.doAction}))),!1)),!0!==(null==e?void 0:e.isolateScope)&&!s.length)for(var c=a.getComponents().filter((function(e){return!~["drawer","dialog"].indexOf(e.props.type)})),p=c.concat();p.length;){var h=p.pop();if(~["crud","form","wizard"].indexOf(h.props.type)){s.push(h);break}~["drawer","dialog"].indexOf(h.props.type)||~["page","service"].indexOf(h.props.type)&&p.unshift.apply(p,h.context.getComponents())}return!!s.length&&(d.markBusying(!0),d.updateMessage(),Promise.all(s.map((function(t){return t.doAction((0,n.Cl)((0,n.Cl)({},e),{from:r.$$id}),o,!0)}))).then((function(n){"submit"!==e.type&&"submit"!==e.actionType&&"confirm"!==e.actionType||!1===e.close?e.close&&(!0===e.close?r.handleSelfClose():r.closeTarget(e.close)):l&&l(n,t||e,o,s),d.markBusying(!1)})).catch((function(e){d.updateMessage(e.message,!0),d.markBusying(!1),clearTimeout(r.clearErrorTimer),r.clearErrorTimer=setTimeout((function(){d.updateMessage("")}),3e3)})),!0)},o.prototype.doAction=function(e,o,t){this.handleAction(void 0,e,o)},o.prototype.handleAction=function(e,o,t,r,s,i){return void 0===r&&(r=!1),(0,n.sH)(this,void 0,void 0,(function(){var l,d,c,p,h,u,m,f,C,g,y=this;return(0,n.YH)(this,(function(v){switch(v.label){case 0:return l=this.props,d=l.onClose,c=l.onAction,p=l.store,h=l.env,u=l.dispatchEvent,m=l.show,o.from!==this.$$id&&m?(null==i?void 0:i.pendingPromise.length)?[4,i.allDone()]:[3,2]:[2,!!c&&c(e,o,t,r,s||this.context)];case 1:v.sent(),v.label=2;case 2:return f=this.context,"close"!==o.actionType&&"cancel"!==o.actionType?[3,6]:[4,u("cancel",(0,a.ed2)(this.props.data,t))];case 3:return(null==(C=v.sent())?void 0:C.prevented)?[2]:(null==C?void 0:C.pendingPromise.length)?[4,C.allDone()]:[3,5];case 4:v.sent(),v.label=5;case 5:return p.setCurrentAction(o,this.props.resolveDefinitions),d(),o.close&&(!0===o.close?this.handleSelfClose():this.closeTarget(o.close)),[3,17];case 6:return"confirm"!==o.actionType?[3,10]:[4,u("confirm",(0,a.ed2)(this.props.data,t))];case 7:return(null==(g=v.sent())?void 0:g.prevented)?[2]:(null==g?void 0:g.pendingPromise.length)?[4,g.allDone()]:[3,9];case 8:v.sent(),v.label=9;case 9:return p.setCurrentAction(o,this.props.resolveDefinitions),this.tryChildrenToHandle(o,t)||d(),[3,17];case 10:return"drawer"!==o.actionType?[3,11]:(p.setCurrentAction(o,this.props.resolveDefinitions),[2,new Promise((function(e){p.openDrawer(t,void 0,(function(t,n){var r;null===(r=o.callback)||void 0===r||r.call(o,t,n),e({confirmed:t,value:n})}))}))]);case 11:return"dialog"!==o.actionType?[3,12]:(p.setCurrentAction(o,this.props.resolveDefinitions),[2,new Promise((function(e){p.openDialog(t,void 0,(function(t,n){var r;null===(r=o.callback)||void 0===r||r.call(o,t,n),e({confirmed:t,value:n})}),s||y.context)}))]);case 12:return"reload"!==o.actionType?[3,13]:(p.setCurrentAction(o,this.props.resolveDefinitions),o.target&&f.reload(o.target,t),o.close&&(!0===o.close?this.handleSelfClose():this.closeTarget(o.close)),[3,17]);case 13:return o.from||!this.tryChildrenToHandle(o,t)?[3,14]:[3,17];case 14:return"ajax"!==o.actionType?[3,15]:(p.setCurrentAction(o,this.props.resolveDefinitions),p.saveRemote(o.api,t,{successMessage:o.messages&&o.messages.success,errorMessage:o.messages&&o.messages.failed}).then((function(){return(0,n.sH)(y,void 0,void 0,(function(){var e;return(0,n.YH)(this,(function(t){switch(t.label){case 0:return o.feedback&&(0,a.zNq)(o.feedback,p.data)?[4,this.openFeedback(o.feedback,p.data)]:[3,2];case 1:t.sent(),t.label=2;case 2:return(e=o.redirect&&(0,a.pbD)(o.redirect,p.data))&&h.jumpTo(e,o,p.data),o.reload&&this.reloadTarget((0,a.Wvn)(o.reload,p.data),p.data),o.close&&(!0===o.close?this.handleSelfClose():this.closeTarget(o.close)),[2]}}))}))})).catch((function(e){if(r||o.countDown)throw e})),[3,17]);case 15:return c?[4,c(e,o,t,r,s||this.context)]:[3,17];case 16:v.sent(),o.close&&(!0===o.close?this.handleSelfClose():this.closeTarget(o.close)),v.label=17;case 17:return[2]}}))}))},o.prototype.handleChildFinished=function(e,o){if(!(o&&o.from===this.$$id||!1===o.close)){var t=this.context.getComponents().filter((function(e){return!~["drawer","dialog","action","button","submit","reset"].indexOf(e.props.type)})),n=this.props.onConfirm;1!==t.length||"form"!==t[0].props.type&&"wizard"!==t[0].props.type||n([e],o,{},t)}},o.prototype.handleDialogConfirm=function(o,t){for(var r,a,s=[],i=2;i<arguments.length;i++)s[i-2]=arguments[i];e.prototype.handleDialogConfirm.apply(this,(0,n.fX)([o,t],(0,n.zs)(s),!1));var l=this.props.store,d=l.getDialogScoped()||this.context,c=l.action,p=null!==(r=t.reload)&&void 0!==r?r:c.reload;p?d.reload(p,l.data):d.component!==this&&(null===(a=d.component)||void 0===a?void 0:a.reload)?d.component.reload():this.context.getComponents().filter((function(e){return"crud"===e.props.type})).forEach((function(e){return e.reload&&e.reload()}))},o.prototype.handleDrawerConfirm=function(o,t){var n,r=this;e.prototype.handleDrawerConfirm.call(this,o,t);var a=this.props.store,s=a.getDialogScoped()||this.context,i=a.action,l=null!==(n=t.reload)&&void 0!==n?n:i.reload;setTimeout((function(){var e;l?s.reload(l,a.data):s.component!==r&&(null===(e=s.component)||void 0===e?void 0:e.reload)?s.component.reload():r.context.getComponents().filter((function(e){return"crud"===e.props.type})).forEach((function(e){return e.reload&&e.reload()}))}),300)},o.prototype.reloadTarget=function(e,o){this.context.reload(e,o)},o.prototype.closeTarget=function(e){this.context.close(e)},o.prototype.setData=function(e,o){return this.props.store.updateData(e,void 0,o)},o.prototype.getData=function(){return this.props.store.data},o.contextType=a.MzX,(0,n.Cg)([(0,a.A49)({type:"drawer",storeType:a.P2M.name,storeExtendsData:!1,isolateScope:!0,shouldSyncSuperStore:function(e,o,t){return!(!e.drawerOpen&&!o.show||o.show===t.show&&!(0,a.JQ)(t.data,o.data))}}),(0,n.Sn)("design:paramtypes",[Object,Object])],o)}(c)}}]);