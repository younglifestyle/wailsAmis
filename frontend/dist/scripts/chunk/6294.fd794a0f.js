"use strict";(self.webpackChunktestAmis=self.webpackChunktestAmis||[]).push([[6294],{16294:function(e,t,r){r.r(t),r.d(t,{MappingField:function(){return u},MappingFieldRenderer:function(){return c},Store:function(){return p}});var n,a=r(31635),i=r(96540),o=r(8096),s=r(65408),l=r(50346),p=o.KNR.named("MappingStore").props({fetching:!1,errorMsg:"",valueField:"value",map:l.gK.frozen({})}).actions((function(e){var t=(0,l.L3)((function(t,r,n){var i,s,l;return(0,a.YH)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,3,4]),e.fetching=!0,[4,t.fetcher(r,n)];case 1:if(!(i=a.sent()).ok)throw new Error(i.msg||"fetch error");return s=(0,o.bqU)(i.data),e.setMap(Array.isArray(s.options)?s.options:Array.isArray(s.items)?s.items:s),[3,4];case 2:return l=a.sent(),e.errorMsg=l.message,[3,4];case 3:return e.fetching=!1,[7];case 4:return[2]}}))}));return{load:t,setMap:function(t){Array.isArray(t)&&(t=t.reduce((function(t,r){if(null==r)return t;if((0,o.Gvm)(r)){var n=Object.keys(r);1===n.length||2==n.length&&n.includes("$$id")?t[(n=n.filter((function(e){return"$$id"!==e})))[0]]=r[n[0]]:n.length>1&&(t[r[e.valueField]]=r)}return t}),{})),(0,o.Gvm)(t)&&(e.map=(0,a.Cl)({},t))}}})),u=(0,s.aH)((function(e){return p.create({id:(0,o.OsD)(),storeType:p.name},e.env)}))(((n=function(e){function t(t){var r=e.call(this,t)||this;return t.store.syncProps(t,void 0,["valueField","map"]),r}return(0,a.C6)(t,e),t.prototype.componentDidMount=function(){this.reload()},t.prototype.componentDidUpdate=function(e){var t=this.props,r=this.props,n=r.store,a=r.source,i=r.data;if(n.syncProps(t,e,a?["valueField"]:["valueField","map"]),(0,o.joH)(a)){var s=(0,o.GvO)(e.source,e.data,"| raw"),l=(0,o.GvO)(a,i,"| raw");s!==l&&n.setMap(l)}else(0,o.B92)(e.source,t.source,e.data,t.data)&&this.reload()},t.prototype.reload=function(){var e,t=this.props,r=t.source,n=t.data,a=t.env,i=this.props.store;if((0,o.joH)(r))i.setMap((0,o.GvO)(r,n,"| raw"));else if((0,o.Amo)(r,n)){var s=(0,o.UfW)(r,"get");s.cache=null!==(e=s.cache)&&void 0!==e?e:3e4,i.load(a,s,n)}},t.prototype.renderSingleValue=function(e,t,r){var n,a=this.props,o=a.className,s=a.style,l=a.placeholder,p=a.classnames,u=a.store,c=i.createElement("span",{className:"text-muted"},l),d=u.map,m=void 0,f=r?s:void 0;return void 0!==(e="string"==typeof e?e.trim():e)&&d&&void 0!==(m=null!==(n=d[e])&&void 0!==n?n:!0===e&&d[1]?d[1]:!1===e&&d[0]?d[0]:d["*"])&&(c=this.renderViewValue(m)),i.createElement("span",{key:"map-".concat(t),className:p("MappingField",o),style:f},c)},t.prototype.renderViewValue=function(e){var t=this.props,r=t.render,n=t.itemSchema,i=t.data,s=t.labelField,l=t.name;if(!n){var p=e;return(0,o.Gvm)(e)&&(p=void 0===s||""===s?e.hasOwnProperty("type")?(0,a.Cl)({name:l},p):e.label:e[s||"label"]),(0,o.Gvm)(p)&&"tag"===p.type&&!(0,o.Gvm)(p.label)&&null!=p.label?r("mapping-tag",p,{value:null}):r("tpl",p)}return r("mappingItemSchema",n,(0,a.Cl)({data:(0,o.ed2)(i,(0,o.Gvm)(e)?e:{item:e})},"tag"===(null==n?void 0:n.type)?{value:null}:{}))},t.prototype.render=function(){var e=this,t=this.props,r=t.style,n=t.defaultValue,a=t.data,s=(0,o.$_G)(this.props);return n&&(0,o.joH)(n)&&n===s&&(s=(0,o.GvO)(n,a,"| raw")),Array.isArray(s)?i.createElement("span",{style:r},s.map((function(t,r){return e.renderSingleValue(t,r)}))):this.renderSingleValue(s,0,!0)},t}(i.Component)).defaultProps={placeholder:"-",map:{"*":"通配值"}},n)),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,a.C6)(t,e),t.prototype.render=function(){return i.createElement(u,(0,a.Cl)({},this.props))},(0,a.Cg)([(0,o.A49)({type:"mapping",alias:["map"],name:"mapping"})],t)}(i.Component)}}]);