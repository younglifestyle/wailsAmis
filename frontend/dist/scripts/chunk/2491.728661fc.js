"use strict";(self.webpackChunktestAmis=self.webpackChunktestAmis||[]).push([[2491],{12491:function(e,t,r){r.r(t),r.d(t,{CardsRenderer:function(){return p},default:function(){return u}});var n=r(31635),a=r(96540),o=r(40961),i=r(8096),s=r(65408),l=r(10246),d=r(7309),c=r.n(d),u=function(e){function t(r){var n=e.call(this,r)||this;n.handleAction=n.handleAction.bind(n),n.handleCheck=n.handleCheck.bind(n),n.handleCheckAll=n.handleCheckAll.bind(n),n.handleQuickChange=n.handleQuickChange.bind(n),n.handleSave=n.handleSave.bind(n),n.handleSaveOrder=n.handleSaveOrder.bind(n),n.reset=n.reset.bind(n),n.dragTipRef=n.dragTipRef.bind(n),n.bodyRef=n.bodyRef.bind(n),n.renderToolbar=n.renderToolbar.bind(n);var a=r.store,o=r.selectable,i=r.draggable,s=r.orderBy,l=r.orderDir,d=r.multiple,c=r.hideCheckToggler,u=r.itemCheckableOn,p=r.itemDraggableOn;return a.update({selectable:o,draggable:i,orderBy:s,orderDir:l,multiple:d,hideCheckToggler:c,itemCheckableOn:u,itemDraggableOn:p}),t.syncItems(a,n.props)&&n.syncSelected(),n}return(0,n.C6)(t,e),t.syncItems=function(e,t,r){var n=t.source,a=(0,i.$_G)(t,(function(e){return e.items})),o=[],s=!1;if(!Array.isArray(a)||r&&(0,i.$_G)(r,(function(e){return e.items}))===a){if("string"==typeof n){var l=(0,i.GvO)(n,t.data,"| raw");(r?(0,i.GvO)(n,r.data,"| raw"):null)===l?s=!1:(o=Array.isArray(l)?l:[],s=!0)}}else o=a,s=!0;return s&&e.initItems(o),Array.isArray(t.selected)&&e.updateSelected(t.selected,t.valueField),s},t.prototype.componentDidUpdate=function(e){var r=this.props,n=r.store;(0,i.TIf)(["selectable","draggable","orderBy","orderDir","multiple","hideCheckToggler","itemCheckableOn","itemDraggableOn"],e,r)&&n.update({selectable:r.selectable,draggable:r.draggable,orderBy:r.orderBy,orderDir:r.orderDir,multiple:r.multiple,hideCheckToggler:r.hideCheckToggler,itemCheckableOn:r.itemCheckableOn,itemDraggableOn:r.itemDraggableOn}),(0,i.TIf)(["source","value","items"],e,r)||!r.value&&!r.items&&(r.data!==e.data||"string"==typeof r.source&&(0,i.joH)(r.source))?t.syncItems(n,r,e)&&this.syncSelected():e.selected!==r.selected&&n.updateSelected(r.selected||[],r.valueField)},t.prototype.bodyRef=function(e){this.body=e},t.prototype.handleAction=function(e,t,r){(0,this.props.onAction)(e,t,r)},t.prototype.handleCheck=function(e){e.toggle(),this.syncSelected()},t.prototype.handleCheckAll=function(){this.props.store.toggleAll(),this.syncSelected()},t.prototype.handleSelectAll=function(){this.props.store.selectAll(),this.syncSelected()},t.prototype.handleClearAll=function(){this.props.store.clearAll(),this.syncSelected()},t.prototype.syncSelected=function(){var e=this.props,t=e.store,r=e.onSelect,n=e.dispatchEvent,a=t.selectedItems.map((function(e){return e.data})),o=t.unSelectedItems.map((function(e){return e.data}));n("selected",(0,i.ed2)(t.data,{selectItems:a,unSelectItems:o})),r&&r(a,o)},t.prototype.handleQuickChange=function(e,t,r,n,a){if(e.change(t,n),r&&!n)if(r&&r.api)this.props.onAction(null,{actionType:"ajax",api:r.api,reload:null==a?void 0:a.reload},e.locals);else{var o=this.props,s=o.onSave,l=o.primaryField;s&&s(e.data,(0,i.iv2)(e.data,e.pristine,["id",l]),e.index,void 0,e.pristine,a)}},t.prototype.handleSave=function(){var e=this.props,t=e.store,r=e.onSave,n=e.primaryField;if(r&&t.modifiedItems.length){var a=t.modifiedItems.map((function(e){return e.data})),o=t.modifiedItems.map((function(e){return e.index}));r(a,t.modifiedItems.map((function(e){return(0,i.iv2)(e.data,e.pristine,["id",n])})),o,t.items.filter((function(e){return!e.modified})).map((function(e){return e.data})),t.modifiedItems.map((function(e){return e.pristine})))}},t.prototype.handleSaveOrder=function(){var e=this.props,t=e.store,r=e.onSaveOrder;r&&t.movedItems.length&&r(t.movedItems.map((function(e){return e.data})),t.items.map((function(e){return e.data})))},t.prototype.reset=function(){this.props.store.reset()},t.prototype.bulkUpdate=function(e,t){var r=this.props,a=r.store,o=r.primaryField;if(o&&e.ids){var i=e.ids.split(","),s=a.items.filter((function(e){return c()(i,(function(t){return t&&t==e.data[o]}))})),l=(0,n.Cl)((0,n.Cl)({},e),{ids:void 0});s.forEach((function(e){return e.change(l)}))}else Array.isArray(t)&&(s=a.items.filter((function(e){return~t.indexOf(e.pristine)}))).forEach((function(t){return t.change(e)}))},t.prototype.getSelected=function(){return this.props.store.selectedItems.map((function(e){return e.data}))},t.prototype.dragTipRef=function(e){!this.dragTip&&e?this.initDragging():this.dragTip&&!e&&this.destroyDragging(),this.dragTip=e},t.prototype.initDragging=function(){if(!this.sortable){var e=this.props.store,t=(0,o.findDOMNode)(this),r=this.props.classPrefix;this.sortable=new l.Ay(t.querySelector(".".concat(r,"Cards-body")),{group:"table",animation:150,handle:".".concat(r,"Card-dragBtn"),ghostClass:"is-dragging",onEnd:function(t){if(t.newIndex!==t.oldIndex){var r=t.to;t.oldIndex<r.childNodes.length-1?r.insertBefore(t.item,r.childNodes[t.oldIndex>t.newIndex?t.oldIndex+1:t.oldIndex]):r.appendChild(t.item),e.exchange(t.oldIndex,t.newIndex)}}})}},t.prototype.destroyDragging=function(){this.sortable&&this.sortable.destroy(),this.sortable=void 0},t.prototype.renderActions=function(e){var t,r=this,o=this.props,i=o.actions,s=o.render,l=o.store,d=o.classnames;return i=Array.isArray(i)?i.concat():[],!~this.renderedToolbars.indexOf("check-all")&&(t=this.renderCheckAll())&&i.unshift({type:"button",children:t}),"header"===e&&!~this.renderedToolbars.indexOf("drag-toggler")&&(t=this.renderDragToggler())&&i.unshift({type:"button",children:t}),Array.isArray(i)&&i.length?a.createElement("div",{className:d("Cards-actions")},i.map((function(e,t){return s("action/".concat(t),(0,n.Cl)({type:"button"},e),{onAction:r.handleAction,key:t,btnDisabled:l.dragging})}))):null},t.prototype.renderHeading=function(){var e=this.props,t=e.title,r=e.store,n=e.hideQuickSaveBtn,o=e.classnames,l=e.data;return t||r.modified&&!n||r.moved?a.createElement("div",{className:o("Cards-heading")},r.modified&&!n?a.createElement("span",null,"当前有 ".concat(r.modified," 条记录修改了内容, 但并没有提交。请选择:"),a.createElement("button",{type:"button",className:o("Button Button--xs Button--success m-l-sm"),onClick:this.handleSave},a.createElement(s.In,{icon:"check",className:"icon m-r-xs"}),"提交"),a.createElement("button",{type:"button",className:o("Button Button--xs Button--danger m-l-sm"),onClick:this.reset},a.createElement(s.In,{icon:"close",className:"icon m-r-xs"}),"放弃")):r.moved?a.createElement("span",null,"当前有 ".concat(r.moved," 条记录修改了顺序, 但并没有提交。请选择:"),a.createElement("button",{type:"button",className:o("Button Button--xs Button--success m-l-sm"),onClick:this.handleSaveOrder},a.createElement(s.In,{icon:"check",className:"icon m-r-xs"}),"提交"),a.createElement("button",{type:"button",className:o("Button Button--xs Button--danger m-l-sm"),onClick:this.reset},a.createElement(s.In,{icon:"close",className:"icon m-r-xs"}),"放弃")):t?(0,i.pbD)(t,l):""):null},t.prototype.renderHeader=function(){var e=this.props,t=e.header,r=e.headerClassName;e.headerToolbar;var o=e.headerToolbarRender,i=e.showHeader,s=e.render,l=e.store,d=e.classnames,c=e.translate;if(!1===i)return null;var u=o?o((0,n.Cl)((0,n.Cl)({},this.props),{selectedItems:l.selectedItems.map((function(e){return e.data})),items:l.items.map((function(e){return e.data})),unSelectedItems:l.unSelectedItems.map((function(e){return e.data}))}),this.renderToolbar):null,p=this.renderActions("header"),h=p||u||l.dragging?a.createElement("div",{className:d("Cards-toolbar"),key:"header-toolbar"},p,u,l.dragging?a.createElement("div",{className:d("Cards-dragTip"),ref:this.dragTipRef},c("Card.dragTip")):null):null,m=t?a.createElement("div",{className:d("Cards-header",r),key:"header"},s("header",t)):null;return m&&h?[m,h]:m||h||null},t.prototype.renderFooter=function(){var e=this.props,t=e.footer,r=e.footerClassName;e.footerToolbar;var o=e.footerToolbarRender,i=e.render,s=e.showFooter,l=e.store,d=e.classnames,c=e.affixFooter;if(!1===s)return null;var u=o?o((0,n.Cl)((0,n.Cl)({},this.props),{selectedItems:l.selectedItems.map((function(e){return e.data})),items:l.items.map((function(e){return e.data})),unSelectedItems:l.unSelectedItems.map((function(e){return e.data}))}),this.renderToolbar):null,p=this.renderActions("footer"),h=t?a.createElement("div",{className:d("Cards-footer",r,c?"Cards-footer--affix":""),key:"footer"},i("footer",t)):null,m=p||u?a.createElement("div",{className:d("Cards-toolbar",!h&&c?"Cards-footToolbar--affix":""),key:"footer-toolbar"},p,u):null;return h&&m?[m,h]:h||m||null},t.prototype.renderCheckAll=function(){var e=this.props,t=e.store,r=e.multiple,n=e.selectable,o=e.checkAll;return t.selectable&&r&&n&&!t.dragging&&t.items.length&&o?a.createElement(s.$n,{key:"checkall",tooltip:"切换全选",onClick:this.handleCheckAll,size:"sm",level:t.allChecked?"info":"default"},"全选"):null},t.prototype.renderDragToggler=function(){var e=this,t=this.props,r=t.store;t.multiple,t.selectable;var n=t.popOverContainer,o=t.env,i=t.translate,l=t.dragIcon;return!r.draggable||r.items.length<2?null:a.createElement(s.$n,{iconOnly:!0,key:"dragging-toggle",tooltip:i("Card.toggleDrag"),tooltipContainer:n||(null==o?void 0:o.getModalContainer),size:"sm",active:r.dragging,onClick:function(t){t.preventDefault(),r.toggleDragging(),r.dragging&&r.clear(),r.dragging&&e.initDragging()}},a.isValidElement(l)?l:a.createElement(s.In,{icon:"exchange",className:"icon r90"}))},t.prototype.renderToolbar=function(e,t){var r=e.type||e;return"drag-toggler"===r?(this.renderedToolbars.push(r),this.renderDragToggler()):"check-all"===r?(this.renderedToolbars.push(r),this.renderCheckAll()):void 0},t.prototype.renderCard=function(e,t,r,o,s){var l=this,d=this.props,c=d.render,u=d.classnames,p=d.store,h=d.multiple,m=d.checkOnItemClick,g=d.hideCheckToggler,f={className:u((0,i.BWH)(t&&t.className||"",r.locals),{"is-checked":r.checked,"is-modified":r.modified,"is-moved":r.moved,"is-dragging":p.dragging}),item:r,key:e,itemIndex:r.index,multiple:h,selectable:p.selectable,checkable:r.checkable,draggable:r.draggable,selected:r.checked,dragging:p.dragging,data:r.locals,onAction:this.handleAction,onCheck:this.handleCheck,onQuickChange:p.dragging?null:this.handleQuickChange};return"card2"===(null==t?void 0:t.type)&&(f=(0,n.Cl)((0,n.Cl)({},f),{item:r.locals,onCheck:function(){l.handleCheck(r)}})),a.createElement("div",{key:r.index,className:u(o),style:s},c("card/".concat(e),(0,n.Cl)({type:t.type||"card",hideCheckToggler:g,checkOnItemClick:m},t),f))},t.prototype.render=function(){var e=this,t=this.props,r=t.className,o=t.style,l=t.store,d=t.columnsCount,c=t.itemClassName,u=t.placeholder,p=t.card,h=t.data,m=t.render,g=t.affixHeader,f=t.masonryLayout,v=t.itemsClassName,y=t.classnames,C=t.translate,b=t.loading,k=void 0!==b&&b,x=t.loadingConfig,T=t.env,A=t.id,I=t.wrapperCustomStyle,N=t.themeCss,S=t.mobileUI;this.renderedToolbars=[];var D=d?"Grid-col--sm".concat(Math.round(12/d)):c||"",E=this.renderHeader(),O=this.renderHeading(),B=this.renderFooter(),w="";f&&(w="Cards--masonry "+D.split(/\s/).map((function(e){return/^Grid-col--(xs|sm|md|lg)(\d+)/.test(e)?"Cards--masonry".concat((0,i.TF7)(RegExp.$1)).concat(RegExp.$2):e})).join(" "));var R={},H={};return(null==o?void 0:o.gutterX)>=0&&(R.marginLeft=R.marginRight=-(null==o?void 0:o.gutterX)/2+"px",H.paddingLeft=H.paddingRight=(null==o?void 0:o.gutterX)/2+"px"),(null==o?void 0:o.gutterY)>=0&&(H.marginBottom=(null==o?void 0:o.gutterY)+"px"),!d||f||S||(H.flex="0 0 ".concat(100/d,"%"),H.maxWidth="".concat(100/d,"%")),a.createElement("div",{ref:this.bodyRef,className:y("Cards",r,{"Cards--unsaved":!!l.modified||!!l.moved},(0,i.NH8)((0,n.Cl)((0,n.Cl)({},this.props),{name:"baseControlClassName",id:A,themeCss:N})),(0,i.NH8)((0,n.Cl)((0,n.Cl)({},this.props),{name:"wrapperCustomStyle",id:A,themeCss:I}))),style:(0,i.K8U)(o,h)},g?a.createElement("div",{className:y("Cards-fixedTop")},E,O):a.createElement(a.Fragment,null,E,O),l.items.length?a.createElement("div",{className:y("Cards-body Grid",v,w),style:R},l.items.map((function(t,r){return e.renderCard(r,p,t,D,H)}))):a.createElement("div",{className:y("Cards-placeholder")},m("placeholder",C(u))),B,a.createElement(s.y$,{loadingConfig:x,overlay:!0,show:k}),a.createElement(i.z4D,(0,n.Cl)({},this.props,{config:{wrapperCustomStyle:I,id:A,themeCss:N,classNames:[{key:"baseControlClassName"}]},env:T})))},t.propsList=["header","headerToolbarRender","footer","footerToolbarRender","placeholder","source","selectable","headerClassName","footerClassName","hideQuickSaveBtn","hideCheckToggler","itemCheckableOn","itemDraggableOn","masonryLayout","items","valueField"],t.defaultProps={className:"",placeholder:"placeholder.noData",source:"$items",selectable:!1,headerClassName:"",footerClassName:"",itemClassName:"Grid-col--sm6 Grid-col--md4 Grid-col--lg3",hideCheckToggler:!1,masonryLayout:!1,affixHeader:!0,itemsClassName:"",checkAll:!0},t}(a.Component),p=function(e){function t(t,r){var n=e.call(this,t)||this;return r.registerComponent(n),n}return(0,n.C6)(t,e),t.prototype.componentWillUnmount=function(){var t;null===(t=e.prototype.componentWillUnmount)||void 0===t||t.call(this),this.context.unRegisterComponent(this)},t.prototype.receive=function(e,t){var r,n,a,o,i=this.context;return null===(r=null==i?void 0:i.parent)||void 0===r||r.getComponents(),(null===(n=this.props)||void 0===n?void 0:n.host)?null===(o=(a=this.props.host).receive)||void 0===o?void 0:o.call(a,e,t):t?i.send(t,e):void 0},t.prototype.reload=function(e,t,r,a,o,i){var s,l,d;return(0,n.sH)(this,void 0,void 0,(function(){var a;return(0,n.YH)(this,(function(n){return this.props.store,(null==i?void 0:i.index)||(null==i?void 0:i.condition)?[2]:(a=this.context,(null===(s=this.props)||void 0===s?void 0:s.host)?[2,null===(d=(l=this.props.host).reload)||void 0===d?void 0:d.call(l,e,t,r)]:e?[2,a.reload(e,r)]:[2])}))}))},t.prototype.setData=function(e,t,r,a){return(0,n.sH)(this,void 0,void 0,(function(){var o;return(0,n.YH)(this,(function(n){switch(n.label){case 0:return o=this.props.store,void 0===r&&void 0===a?[3,2]:[4,(0,i.dBT)(o.items,this.props.data,r,a)];case 1:return n.sent().forEach((function(t){t.updateData(e)})),[3,3];case 2:return[2,o.updateData(e,void 0,t)];case 3:return[2]}}))}))},t.prototype.getData=function(){var e=this.props,t=e.store,r=e.data;return t.getData(r)},t.prototype.doAction=function(e,t,r,a){return(0,n.sH)(this,void 0,void 0,(function(){var r,o,s,l,d;return(0,n.YH)(this,(function(n){switch(n.label){case 0:switch(r=this.props,o=r.store,s=r.valueField,l=r.data,null==e?void 0:e.actionType){case"selectAll":return[3,1];case"clearAll":return[3,2];case"select":return[3,3];case"initDrag":return[3,5];case"cancelDrag":return[3,6];case"submitQuickEdit":return[3,7]}return[3,9];case 1:return o.clear(),o.toggleAll(),[3,10];case 2:return o.clear(),[3,10];case 3:return[4,(0,i.dBT)(o.items,t||this.props.data,a.index,a.condition,a.selected)];case 4:return d=n.sent(),o.updateSelected(d.map((function(e){return e.data})),s),[3,10];case 5:return o.startDragging(),[3,10];case 6:return o.stopDragging(),[3,10];case 7:return[4,this.handleSave()];case 8:return n.sent(),[3,10];case 9:return[2,this.handleAction(void 0,e,l)];case 10:return[2]}}))}))},t.contextType=i.MzX,(0,n.Cg)([(0,i.A49)({name:"cards",type:"cards",storeType:i.irU.name,weight:-100}),(0,n.Sn)("design:paramtypes",[Object,Object])],t)}(u)}}]);