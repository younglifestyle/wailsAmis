"use strict";(self.webpackChunktestAmis=self.webpackChunktestAmis||[]).push([[4497],{44497:function(e,t,n){n.r(t),n.d(t,{PageRenderer:function(){return d},default:function(){return l}});var o=n(31635),a=n(96540),i=n(8096),r=n(65408),s=n(50346),l=function(e){function t(t){var n=e.call(this,t)||this;return(0,i.v6M)(n,["handleAction","handleChange","handleBulkChange","handleQuery","handleDialogConfirm","handleDialogClose","handleDrawerConfirm","handleDrawerClose","handleClick","reload","silentReload","initInterval"]),n.style=document.createElement("style"),n.style.setAttribute("data-page",""),document.getElementsByTagName("head")[0].appendChild(n.style),n.updateStyle(),n.varStyle=document.createElement("style"),n.varStyle.setAttribute("data-vars",""),document.getElementsByTagName("head")[0].appendChild(n.varStyle),n.updateVarStyle(),n}return(0,o.C6)(t,e),t.prototype.updateStyle=function(){this.props.css||this.props.mobileCSS?this.style.innerHTML="\n      ".concat(this.buildCSS(this.props.css),"\n\n      @media (max-width: 768px) {\n        ").concat(this.buildCSS(this.props.mobileCSS),"\n      }\n      "):this.style.innerHTML=""},t.prototype.buildCSS=function(e){if(!e)return"";var t="";for(var n in e){var o=e[n],a="";for(var i in o){var r="",s=o[i];if("string"==typeof s)a+="  ".concat(i,": ").concat(s,";\n");else{for(var l in s)r+=" ".concat(l,":").concat(s[l],";");a+="  ".concat(i," {").concat(r,"}\n")}}t+="\n      ".concat(n," {\n        ").concat(a,"\n      }\n      ")}return t},t.prototype.updateVarStyle=function(){var e=this.props.cssVars,t="";if(e){for(var n in e)if(n.startsWith("--")){if(-1!==n.indexOf(":"))continue;var o=e[n];if("string"==typeof o&&(-1!==o.indexOf("expression(")||-1!==o.indexOf(";")))continue;t+="".concat(n,": ").concat(o,"; \n")}this.varStyle.innerHTML="\n      :root {\n        ".concat(t,"\n      }\n      ")}},t.prototype.componentDidMount=function(){return(0,o.sH)(this,void 0,void 0,(function(){var e,t,n,a,r,l,d,p,c,h;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=this.props,t=e.initApi,n=e.initFetch,a=e.initFetchOn,r=e.store,l=e.messages,d=e.data,p=e.dispatchEvent,c=e.env,this.mounted=!0,[4,p("init",d,this)];case 1:return h=o.sent(),(null==c?void 0:c.tracker)&&c.tracker({eventType:"pageLoaded"},this.props),(null==h?void 0:h.prevented)||!(0,s._n)(r)||(0,i.Amo)(t,r.data,n,a)&&r.fetchInitData(t,r.data,{successMessage:l&&l.fetchSuccess,errorMessage:l&&l.fetchFailed}).then(this.initInterval),[2]}}))}))},t.prototype.componentDidUpdate=function(e){var t=this.props,n=t.store,o=t.initApi;if(t.initFetchOn&&t.initFetch&&!e.initFetch||!1!==t.initFetch&&(0,i.B92)(e.initApi,o,e.data,t.data)){var a=t.messages;(0,i.Amo)(o,n.data)&&n.fetchData(o,n.data,{successMessage:a&&a.fetchSuccess,errorMessage:a&&a.fetchFailed}).then(this.initInterval)}JSON.stringify(t.css)===JSON.stringify(e.css)&&JSON.stringify(t.mobileCSS)===JSON.stringify(e.mobileCSS)||this.updateStyle(),JSON.stringify(t.cssVars)!==JSON.stringify(e.cssVars)&&this.updateVarStyle(),(0,i.JQ)(e.defaultData,t.defaultData)&&n.reInitData(t.defaultData)},t.prototype.componentWillUnmount=function(){var e,t;this.mounted=!1,clearTimeout(this.timer),this.style&&(null===(e=this.style.parentNode)||void 0===e||e.removeChild(this.style)),this.varStyle&&(null===(t=this.varStyle.parentNode)||void 0===t||t.removeChild(this.varStyle))},t.prototype.reloadTarget=function(e,t){},t.prototype.handleAction=function(e,t,n,a,r){var s=this;void 0===a&&(a=!1);var l=this.props,d=l.env,p=l.store,c=l.messages,h=l.onAction;if("dialog"===t.actionType)return p.setCurrentAction(t,this.props.resolveDefinitions),new Promise((function(e){p.openDialog(n,void 0,(function(n,o){var a;null===(a=t.callback)||void 0===a||a.call(t,n,o),e({confirmed:n,value:o})}),r||s.context)}));if("drawer"===t.actionType)return p.setCurrentAction(t,this.props.resolveDefinitions),new Promise((function(e){p.openDrawer(n,void 0,(function(n,o){var a;null===(a=t.callback)||void 0===a||a.call(t,n,o),e({confirmed:n,value:o})}),r)}));if("ajax"===t.actionType){if(p.setCurrentAction(t,this.props.resolveDefinitions),!(0,i.Amo)(t.api,n))return;return p.saveRemote(t.api,n,{successMessage:t.messages&&t.messages.success||c&&c.saveSuccess,errorMessage:t.messages&&t.messages.failed||c&&c.saveSuccess}).then((function(){return(0,o.sH)(s,void 0,void 0,(function(){var e;return(0,o.YH)(this,(function(n){switch(n.label){case 0:return t.feedback&&(0,i.zNq)(t.feedback,p.data)?[4,this.openFeedback(t.feedback,p.data)]:[3,2];case 1:n.sent(),n.label=2;case 2:return(e=t.redirect&&(0,i.pbD)(t.redirect,p.data))&&d.jumpTo(e,t,p.data),t.reload&&this.reloadTarget((0,i.Wvn)(t.reload,p.data),p.data),[2]}}))}))})).catch((function(e){if(a||t.countDown)throw e}))}return h(e,t,n,a,r||this.context)},t.prototype.handleQuery=function(e){return this.props.initApi?!((null==e?void 0:e.hasOwnProperty("orderBy"))&&!(0,i.B92)(this.props.initApi,this.props.initApi,this.props.store.data,(0,i.ed2)(this.props.store.data,e)))&&void this.receive(e):!!this.props.onQuery&&this.props.onQuery(e)},t.prototype.handleDialogConfirm=function(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];var i=this.props.store;t.mergeData&&1===e.length&&e[0]&&i.updateData(e[0]);var r=i.action.dialog;r&&r.onConfirm&&!1===r.onConfirm.apply(r,(0,o.fX)([e,t],(0,o.zs)(n),!1))||i.closeDialog(!0,e)},t.prototype.handleDialogClose=function(e){void 0===e&&(e=!1),this.props.store.closeDialog(e)},t.prototype.handleDrawerConfirm=function(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];var i=this.props.store;t.mergeData&&1===e.length&&e[0]&&i.updateData(e[0]);var r=i.action.dialog;r&&r.onConfirm&&!1===r.onConfirm.apply(r,(0,o.fX)([e,t],(0,o.zs)(n),!1))||i.closeDrawer(!0,e)},t.prototype.handleDrawerClose=function(){this.props.store.closeDrawer(!1)},t.prototype.handleClick=function(e){var t,n=e.target,o=this.props.env,a="A"===n.tagName&&n.hasAttribute("data-link")?n.getAttribute("data-link"):null===(t=n.closest("a[data-link]"))||void 0===t?void 0:t.getAttribute("data-link");o&&a&&(o.jumpTo(a,void 0,this.props.data),e.preventDefault())},t.prototype.handleResizeMouseDown=function(e){3==e.nativeEvent.which||(this.codeWrap=e.currentTarget.parentElement,document.addEventListener("mousemove",this.handleResizeMouseMove),document.addEventListener("mouseup",this.handleResizeMouseUp),this.startX=e.clientX,this.startWidth=this.codeWrap.offsetWidth)},t.prototype.handleResizeMouseMove=function(e){var t=this.props,n=t.asideMinWidth,o=void 0===n?160:n,a=t.asideMaxWidth,i=void 0===a?350:a,r=e.clientX-this.startX,s=this.startWidth+r,l=Math.min(Math.max(s,o),i);this.codeWrap.style.cssText+="width: ".concat(l,"px")},t.prototype.handleResizeMouseUp=function(){document.removeEventListener("mousemove",this.handleResizeMouseMove),document.removeEventListener("mouseup",this.handleResizeMouseUp)},t.prototype.openFeedback=function(e,t){var n=this;return new Promise((function(o){var a=n.props.store;a.setCurrentAction({type:"button",actionType:"dialog",dialog:e},n.props.resolveDefinitions),a.openDialog(t,void 0,(function(e){o(e)}),n.context)}))},t.prototype.reload=function(e,t,n,a,r){return(0,o.sH)(this,void 0,void 0,(function(){var e,n,s,l;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return t?[2,this.receive(t,void 0,r)]:(e=this.props,n=e.store,s=e.initApi,clearTimeout(this.timer),(0,i.Amo)(s,n.data)?[4,n.fetchData(s,n.data,{silent:a})]:[3,2]);case 1:l=o.sent(),this.initInterval(l),o.label=2;case 2:return[2,n.data]}}))}))},t.prototype.receive=function(e,t,n){this.props.store.updateData(e,void 0,n),this.reload()},t.prototype.silentReload=function(e,t){this.reload(t,void 0,void 0,!0)},t.prototype.initInterval=function(e){var t,n=this.props,a=n.interval,r=n.silentPolling,s=n.stopAutoRefreshWhen,l=n.data,d=n.dispatchEvent,p=n.store;return d("inited",(0,i.ed2)(l,(0,o.Cl)((0,o.Cl)({},null==e?void 0:e.data),{responseData:(null==e?void 0:e.ok)?null!==(t=null==e?void 0:e.data)&&void 0!==t?t:{}:e,responseStatus:void 0===(null==e?void 0:e.status)?(null==p?void 0:p.error)?1:0:null==e?void 0:e.status,responseMsg:(null==e?void 0:e.msg)||(null==p?void 0:p.msg)}))),(null==e?void 0:e.ok)&&a&&this.mounted&&(!s||!(0,i.pgu)(s,l))&&(this.timer=setTimeout(r?this.silentReload:this.reload,Math.max(a,1e3))),e},t.prototype.handleRefresh=function(){return(0,o.sH)(this,void 0,void 0,(function(){var e,t,n,a;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=this.props,t=e.dispatchEvent,n=e.data,[4,t("pullRefresh",n)];case 1:return(null==(a=o.sent())?void 0:a.prevented)||this.reload(),[2]}}))}))},t.prototype.handleChange=function(e,t,n,o){var a=this.props,i=a.store,r=a.onChange;"string"==typeof t&&t&&i.changeValue(t,e,o),null==r||r.apply(null,arguments)},t.prototype.handleBulkChange=function(e){var t,n;null===(n=null===(t=this.props.store)||void 0===t?void 0:t.updateData)||void 0===n||n.call(t,e)},t.prototype.renderHeader=function(){var e=this.props,t=e.title,n=e.subTitle,r=e.remark,s=e.remarkPlacement,l=e.headerClassName,d=e.toolbarClassName,p=e.toolbar,c=e.render,h=e.store,u=e.initApi,m=e.popOverContainer,v=e.env,y=e.classnames,f=e.regions;e.translate;var g,C,b=e.id,S=e.themeCss,D={onAction:this.handleAction,onQuery:u?this.handleQuery:void 0,onChange:this.handleChange,onBulkChange:this.handleBulkChange,pageLoading:h.loading};return(Array.isArray(f)?~f.indexOf("header"):t||n)&&(g=a.createElement("div",{className:y("Page-header",l,(0,i.NH8)((0,o.Cl)((0,o.Cl)({},this.props),{name:"headerControlClassName",id:b,themeCss:S})))},t?a.createElement("h2",{className:y("Page-title",(0,i.NH8)((0,o.Cl)((0,o.Cl)({},this.props),{name:"titleControlClassName",id:b,themeCss:S})))},c("title",t,D),r?c("remark",{type:"remark",tooltip:r,placement:s||"bottom",container:m||v.getModalContainer}):null):null,n&&a.createElement("small",{className:y("Page-subTitle")},c("subTitle",n,D)))),(Array.isArray(f)?~f.indexOf("toolbar"):p)&&(C=a.createElement("div",{className:y("Page-toolbar",d,(0,i.NH8)((0,o.Cl)((0,o.Cl)({},this.props),{name:"toolbarControlClassName",id:b,themeCss:S})))},c("toolbar",p||"",D))),g&&C?a.createElement("div",{className:y("Page-headerRow")},g,C):g||C},t.prototype.renderContent=function(e){var t=this.props,n=t.store,s=t.body,l=t.bodyClassName,d=t.render,p=t.classnames,c=t.showErrorMsg,h=t.regions;t.translate;var u=t.loadingConfig;t.initApi;var m=t.id,v=t.env,y=t.themeCss;return a.createElement("div",{className:p("Page-content")},a.createElement("div",{className:p("Page-main")},this.renderHeader(),a.createElement("div",{className:p("Page-body",l,(0,i.NH8)((0,o.Cl)((0,o.Cl)({},this.props),{name:"bodyControlClassName",id:m,themeCss:y}))),role:"page-body"},a.createElement(r.y$,{size:"lg",overlay:!0,key:"info",show:n.loading,loadingConfig:u}),!v.forceSilenceInsideError&&n.error&&!1!==c?a.createElement(r.pM,{level:"danger",showCloseButton:!0,onClose:n.clearMessage},n.msg):null,(Array.isArray(h)?~h.indexOf("body"):s)?d("body",s||"",e):null)))},t.prototype.render=function(){var e=this.props,t=e.className,n=e.store;e.body,e.bodyClassName;var s=e.render,l=e.aside,d=e.asideClassName,p=e.classnames;e.showErrorMsg;var c=e.initApi,h=e.regions,u=e.style,m=e.data,v=e.asideResizor,y=e.asideSticky,f=e.pullRefresh,g=e.mobileUI,C=e.translate;e.loadingConfig;var b=e.id,S=e.wrapperCustomStyle,D=e.env,N=e.themeCss,A={onAction:this.handleAction,onQuery:c?this.handleQuery:void 0,onChange:this.handleChange,onBulkChange:this.handleBulkChange,pageLoading:n.loading},w=Array.isArray(h)?~h.indexOf("aside"):l&&(!Array.isArray(l)||l.length),k=(0,i.K8U)(u,m),M=this.renderContent(A);return a.createElement("div",{className:p("Page",w?"Page--withSidebar":"",w&&y?"Page--asideSticky":"",t,(0,i.NH8)((0,o.Cl)({name:"baseControlClassName",id:b,themeCss:N},this.props)),(0,i.NH8)((0,o.Cl)({name:"wrapperCustomStyle",id:b,themeCss:S},this.props))),onClick:this.handleClick,style:k},w?a.createElement("div",{className:p("Page-aside",v?"relative":"Page-aside--withWidth",d,(0,i.NH8)((0,o.Cl)((0,o.Cl)({},this.props),{name:"asideControlClassName",id:b,themeCss:N})))},s("aside",l||"",(0,o.Cl)((0,o.Cl)({},A),"string"==typeof l?{inline:!1,className:"Page-asideTplWrapper"}:null)),v?a.createElement("div",{onMouseDown:this.handleResizeMouseDown,className:p("Page-asideResizor")}):null):null,g&&f&&!f.disabled?a.createElement(r.j5,(0,o.Cl)({},f,{translate:C,onRefresh:this.handleRefresh}),M):M,s("dialog",(0,o.Cl)((0,o.Cl)({},n.action&&n.action.dialog),{type:"dialog"}),{key:"dialog",data:n.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,show:n.dialogOpen,onAction:this.handleAction,onQuery:c?this.handleQuery:void 0}),s("drawer",(0,o.Cl)((0,o.Cl)({},n.action&&n.action.drawer),{type:"drawer"}),{key:"drawer",data:n.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,show:n.drawerOpen,onAction:this.handleAction,onQuery:c?this.handleQuery:void 0}),a.createElement(i.z4D,(0,o.Cl)({},this.props,{config:{wrapperCustomStyle:S,id:b,themeCss:N,classNames:[{key:"baseControlClassName",weights:{default:{important:!0},hover:{important:!0},active:{important:!0}}},{key:"bodyControlClassName"},{key:"headerControlClassName"},{key:"titleControlClassName"},{key:"toolbarControlClassName"},{key:"asideControlClassName"}]},env:D})))},t.defaultProps={asideClassName:"",bodyClassName:"",headerClassName:"",initFetch:!0,toolbarClassName:"",messages:{},asideSticky:!0,pullRefresh:{disabled:!0}},t.propsList=["title","subTitle","initApi","initFetchOn","initFetch","headerClassName","bodyClassName","asideClassName","toolbarClassName","toolbar","body","aside","messages","style","showErrorMsg"],(0,o.Cg)([i.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"handleResizeMouseDown",null),(0,o.Cg)([i.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[MouseEvent]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"handleResizeMouseMove",null),(0,o.Cg)([i.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"handleResizeMouseUp",null),(0,o.Cg)([i.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[]),(0,o.Sn)("design:returntype",Promise)],t.prototype,"handleRefresh",null),t}(a.Component),d=function(e){function t(t,n){var o=e.call(this,t)||this;return n.registerComponent(o),o}return(0,o.C6)(t,e),t.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),e.prototype.componentWillUnmount.call(this)},t.prototype.reloadTarget=function(e,t){this.context.reload(e,t)},t.prototype.handleAction=function(t,n,a,i,r){return void 0===i&&(i=!1),(0,o.sH)(this,void 0,void 0,(function(){var s,l;return(0,o.YH)(this,(function(d){switch(d.label){case 0:return s=r||this.context,"reload"!==n.actionType?[3,1]:(n.target&&s.reload(n.target,a),[3,4]);case 1:return n.target?(n.target.split(",").forEach((function(e){var t=s.getComponentByName(e);t&&t.doAction&&t.doAction((0,o.Cl)((0,o.Cl)({},n),{target:void 0}),a)})),[3,4]):[3,2];case 2:return[4,e.prototype.handleAction.call(this,t,n,a,i,r)];case 3:return l=d.sent(),n.reload&&~["url","link","jump"].indexOf(n.actionType)&&s.reload(n.reload,a),[2,l];case 4:return[2]}}))}))},t.prototype.handleDialogConfirm=function(t,n){for(var a,i,r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];var l=this.props.store,d=l.action,p=null!==(a=n.reload)&&void 0!==a?a:d.reload,c=l.getDialogScoped()||this.context;e.prototype.handleDialogConfirm.apply(this,(0,o.fX)([t,n],(0,o.zs)(r),!1)),p?c.reload(p,l.data):(null==c?void 0:c.component)!==this&&(null===(i=c.component)||void 0===i?void 0:i.reload)?c.component.reload():this.context.getComponents().filter((function(e){return"crud"===e.props.type})).forEach((function(e){return e.reload&&e.reload()}))},t.prototype.handleDrawerConfirm=function(t,n){var o,a=this,i=this.props.store,r=i.action,s=null!==(o=n.reload)&&void 0!==o?o:r.reload,l=i.getDrawerScoped()||this.context;e.prototype.handleDrawerConfirm.call(this,t,n),setTimeout((function(){var e;s?l.reload(s,i.data):l.component!==a&&(null===(e=null==l?void 0:l.component)||void 0===e?void 0:e.reload)?l.component.reload():a.context.getComponents().filter((function(e){return"crud"===e.props.type})).forEach((function(e){return e.reload&&e.reload()}))}),300)},t.prototype.setData=function(e,t){return this.props.store.updateData(e,void 0,t)},t.prototype.getData=function(){return this.props.store.data},t.contextType=i.MzX,(0,o.Cg)([(0,i.A49)({type:"page",storeType:i.DtI.name,isolateScope:!0}),(0,o.Sn)("design:paramtypes",[Object,Object])],t)}(l)}}]);