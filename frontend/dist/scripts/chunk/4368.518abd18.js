"use strict";(self.webpackChunktestAmis=self.webpackChunktestAmis||[]).push([[4368],{14368:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Chart:function(){return Chart},ChartRenderer:function(){return ChartRenderer}});var tslib__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(31635),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(96540),amis_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8096),classnames__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(32485),classnames__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_2__),mobx_state_tree__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(50346),lodash_debounce__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(38221),lodash_debounce__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(lodash_debounce__WEBPACK_IMPORTED_MODULE_3__),lodash_pick__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(44383),lodash_pick__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(lodash_pick__WEBPACK_IMPORTED_MODULE_4__),lodash_isString__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(85015),lodash_isString__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(lodash_isString__WEBPACK_IMPORTED_MODULE_5__),DEFAULT_EVENT_PARAMS=["componentType","seriesType","seriesIndex","seriesName","name","dataIndex","data","dataType","value","color"],EVAL_CACHE={};function recoverFunctionType(config){["interval","formatter","color","min","max","labelFormatter","valueFormatter","pageFormatter","optionToContent","contentToOption","animationDelay","animationDurationUpdate","animationDelayUpdate","animationDuration","position","sort","renderItem"].forEach((function(key){var e_1,_a,objects=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.Vse)(config,key);try{for(var objects_1=(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Ju)(objects),objects_1_1=objects_1.next();!objects_1_1.done;objects_1_1=objects_1.next()){var object=objects_1_1.value,code=object[key];if("string"==typeof code&&code.trim().startsWith("function"))try{code in EVAL_CACHE||(EVAL_CACHE[code]=eval("("+code+")")),object[key]=EVAL_CACHE[code]}catch(_){console.warn(code,_)}}}catch(_){e_1={error:_}}finally{try{objects_1_1&&!objects_1_1.done&&(_a=objects_1.return)&&_a.call(objects_1)}finally{if(e_1)throw e_1.error}}}))}var Chart=function(_){function e(e){var t=_.call(this,e)||this;return t.refFn=t.refFn.bind(t),t.reload=t.reload.bind(t),t.reloadEcharts=lodash_debounce__WEBPACK_IMPORTED_MODULE_3___default()(t.reloadEcharts.bind(t),300),t.handleClick=t.handleClick.bind(t),t.dispatchEvent=t.dispatchEvent.bind(t),t.loadChartMapData=t.loadChartMapData.bind(t),t.mounted=!0,e.config&&t.renderChart(e.config),t}return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.C6)(e,_),e.prototype.componentDidMount=function(){return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.sH)(this,void 0,void 0,(function(){var _,e,t,r,a,i,s;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.YH)(this,(function(o){switch(o.label){case 0:return _=this.props,e=_.api,t=_.data,r=_.initFetch,a=_.source,[4,(0,_.dispatchEvent)("init",t,this)];case 1:return(null==(i=o.sent())?void 0:i.prevented)||(a&&(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.joH)(a)?(s=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.GvO)(a,t,"| raw"))&&this.renderChart(s):e&&!1!==r&&this.reload()),[2]}}))}))},e.prototype.componentDidUpdate=function(_){var e=this,t=this.props;if((0,amis_core__WEBPACK_IMPORTED_MODULE_1__.B92)(_.api,t.api,_.data,t.data))this.reload();else if(t.source&&(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.joH)(t.source)){var r=_.source?(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.GvO)(_.source,_.data,"| raw"):null,a=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.GvO)(t.source,t.data,"| raw");r!==a&&this.renderChart(a||{})}else if(t.config!==_.config)this.renderChart(t.config||{});else if(t.config&&t.trackExpression&&(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.pbD)(t.trackExpression,t.data)!==(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.pbD)(_.trackExpression,_.data))this.renderChart(t.config||{});else if((0,amis_core__WEBPACK_IMPORTED_MODULE_1__.B92)(_.mapURL,t.mapURL,_.data,t.data)){var i=t.source,s=t.data,o=t.api,n=t.config;this.loadChartMapData((function(){if(i&&(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.joH)(i)){var _=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.GvO)(i,s,"| raw");_&&e.renderChart(_)}else o?e.reload():n&&e.renderChart(n||{})}))}},e.prototype.componentWillUnmount=function(){this.mounted=!1,this.reloadEcharts.cancel(),clearTimeout(this.timer)},e.prototype.loadChartMapData=function(_){return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.sH)(this,void 0,void 0,(function(){var e,t,r,a,i,s,o;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.YH)(this,(function(n){switch(n.label){case 0:return e=this.props,t=e.env,r=e.data,a=this.props,i=a.mapName,(s=a.mapURL)&&i&&window.echarts?((0,amis_core__WEBPACK_IMPORTED_MODULE_1__.joH)(i)&&(i=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.GvO)(i,r)),[4,t.fetcher(s,r)]):[3,2];case 1:(o=n.sent()).ok||console.warn("fetch map geo error "+s),window.echarts.registerMap(i,o.data),n.label=2;case 2:return _&&_(),[2]}}))}))},e.prototype.handleClick=function(_){return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.sH)(this,void 0,void 0,(function(){var e,t,r,a,i;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.YH)(this,(function(s){switch(s.label){case 0:return e=this.props,t=e.onAction,r=e.clickAction,a=e.data,[4,(0,e.dispatchEvent)(_.event,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.ed2)(a,(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Cl)({},lodash_pick__WEBPACK_IMPORTED_MODULE_4___default()(_,DEFAULT_EVENT_PARAMS))))];case 1:return(null==(i=s.sent())?void 0:i.prevented)||r&&t&&t(null,r,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.ed2)(a,_)),[2]}}))}))},e.prototype.dispatchEvent=function(_){var e=this.props,t=e.data;(0,e.dispatchEvent)(_.event||_.type,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.ed2)(t,(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Cl)({},lodash_pick__WEBPACK_IMPORTED_MODULE_4___default()(_,"legendselectchanged"===_.type?["name","selected"]:DEFAULT_EVENT_PARAMS))))},e.prototype.refFn=function(_){var e=this,t=this.props.chartRef,r=this.props,a=r.chartTheme,i=r.onChartWillMount,s=r.onChartUnMount,o=r.env,n=r.loadBaiduMap;r.data;var c=this.props,E=c.mapURL,l=c.mapName,h=this.props.onChartMount||this.onChartMount;_?Promise.all([__webpack_require__.e(3366).then(__webpack_require__.bind(__webpack_require__,73366)),__webpack_require__.e(4970).then(__webpack_require__.t.bind(__webpack_require__,54970,23)),Promise.all([__webpack_require__.e(3366),__webpack_require__.e(4223)]).then(__webpack_require__.bind(__webpack_require__,54223)),Promise.all([__webpack_require__.e(3366),__webpack_require__.e(3697)]).then(__webpack_require__.bind(__webpack_require__,13697)),__webpack_require__.e(9552).then(__webpack_require__.t.bind(__webpack_require__,79552,23))]).then((function(r){var s=(0,tslib__WEBPACK_IMPORTED_MODULE_6__.zs)(r,2),c=s[0],d=s[1];return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.sH)(e,void 0,void 0,(function(){var e,r=this;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.YH)(this,(function(s){switch(s.label){case 0:return window.echarts=c,window.ecStat=(null==d?void 0:d.default)||d,E&&l?[4,this.loadChartMapData()]:[3,2];case 1:s.sent(),s.label=2;case 2:return n?[4,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.k07)("//api.map.baidu.com/api?v=3.0&ak=".concat(this.props.ak,"&callback={{callback}}"))]:[3,4];case 3:s.sent(),s.label=4;case 4:return e="default",a&&(c.registerTheme("custom",a),e="custom"),i?[4,i(c)]:[3,6];case 5:s.sent(),s.label=6;case 6:return d.transform&&(c.registerTransform(d.transform.regression),c.registerTransform(d.transform.histogram),c.registerTransform(d.transform.clustering)),o.loadChartExtends?[4,o.loadChartExtends()]:[3,8];case 7:s.sent(),s.label=8;case 8:return this.echarts=c.init(_,e),"string"==typeof h&&(h=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.sce)(h,"chart","echarts")),null==h||h(this.echarts,c),this.echarts.on("click",this.handleClick),this.echarts.on("mouseover",this.dispatchEvent),this.echarts.on("legendselectchanged",this.dispatchEvent),this.unSensor=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.zMn)(_,(function(){var e,t=_.offsetWidth,a=_.offsetHeight;null===(e=r.echarts)||void 0===e||e.resize({width:t,height:a})})),t&&t(this.echarts),this.renderChart(),[2]}}))}))})):(t&&t(null),this.unSensor&&this.unSensor(),this.echarts&&(null==s||s(this.echarts,window.echarts),this.echarts.dispose(),delete this.echarts)),this.ref=_},e.prototype.doAction=function(_,e,t){var r,a;return null===(a=null===(r=this.echarts)||void 0===r?void 0:r.dispatchAction)||void 0===a?void 0:a.call(r,(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Cl)({type:_.actionType},e))},e.prototype.reload=function(_,e,t,r,a){var i,s,o,n,c,E;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.sH)(this,void 0,void 0,(function(){var _,t,r,l,h,d,p,u,D,M,O=this;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.YH)(this,(function(P){switch(P.label){case 0:if(_=this.props,t=_.api,r=_.env,l=_.store,h=_.translate,e)return[2,this.receive(e,void 0,a)];if(!r||!r.fetcher||!(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.Amo)(t,l.data))return[2];clearTimeout(this.timer),this.reloadCancel&&(this.reloadCancel(),delete this.reloadCancel,null===(i=this.echarts)||void 0===i||i.hideLoading()),null===(s=this.echarts)||void 0===s||s.showLoading(),l.markFetching(!0),P.label=1;case 1:return P.trys.push([1,3,,4]),[4,r.fetcher(t,l.data,{cancelExecutor:function(_){return O.reloadCancel=_}})];case 2:return d=P.sent(),(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_7__._n)(l)&&l.markFetching(!1),d.ok?(delete this.reloadCancel,!(p=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.bqU)(d.data)).series&&this.props.config?(u=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.ed2)(this.props.data,p),this.renderChart(this.props.config,u)):this.renderChart(d.data||{}),null===(c=this.echarts)||void 0===c||c.hideLoading(),(D=this.props.interval)&&lodash_isString__WEBPACK_IMPORTED_MODULE_5___default()(D)&&(D=Number.parseInt(D)),D&&this.mounted&&(this.timer=setTimeout(this.reload,Math.max(D,1e3))),[2,l.data]):(!(null==t?void 0:t.silent)&&r.notify("error",null!==(n=null===(o=null==t?void 0:t.messages)||void 0===o?void 0:o.failed)&&void 0!==n?n:d.msg||h("fetchFailed"),void 0!==d.msgTimeout?{closeButton:!0,timeout:d.msgTimeout}:void 0),[2]);case 3:return M=P.sent(),r.isCancel(M)?[2]:((0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_7__._n)(l)&&l.markFetching(!1),!(null==t?void 0:t.silent)&&r.notify("error",M),null===(E=this.echarts)||void 0===E||E.hideLoading(),[3,4]);case 4:return[2]}}))}))},e.prototype.receive=function(_,e,t){this.props.store.updateData(_,void 0,t),this.reload()},e.prototype.renderChart=function(_,e){var t,r;if(_&&(this.pending=_),e&&(this.pendingCtx=e),this.echarts){var a=this.props.store,i=this.props.onDataFilter,s=this.props.dataFilter;i||"string"!=typeof s||(i=new Function("config","echarts","data",s)),_=_||this.pending,e=e||this.pendingCtx||this.props.data,"string"==typeof _&&(_=new Function("return "+_)());try{i&&(_=i(_,window.echarts,e)||_)}catch(_){console.warn(_)}if(_)try{this.props.disableDataMapping||(_=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.nd1)(_,e,(function(_,e){return"function"==typeof e||"string"==typeof e&&e.startsWith("function")}))),recoverFunctionType(_),(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_7__._n)(a)&&a.loading?null===(t=this.echarts)||void 0===t||t.showLoading():null===(r=this.echarts)||void 0===r||r.hideLoading(),this.reloadEcharts(_)}catch(_){console.warn(_)}}},e.prototype.reloadEcharts=function(_){var e;null===(e=this.echarts)||void 0===e||e.setOption(_,this.props.replaceChartOption)},e.prototype.render=function(){var _=this,e=this.props,t=e.className,r=e.width,a=e.height,i=e.classPrefix,s=e.unMountOnHidden,o=e.data,n=e.id,c=e.wrapperCustomStyle,E=e.env,l=e.themeCss;e.baseControlClassName;var h=this.props.style||{};h.width=h.width||r||"100%",h.height=h.height||a||"300px";var d=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.K8U)(h,o);return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:classnames__WEBPACK_IMPORTED_MODULE_2___default()("".concat(i,"Chart"),t,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.NH8)((0,tslib__WEBPACK_IMPORTED_MODULE_6__.Cl)((0,tslib__WEBPACK_IMPORTED_MODULE_6__.Cl)({},this.props),{name:"baseControlClassName",id:n,themeCss:l})),(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.NH8)((0,tslib__WEBPACK_IMPORTED_MODULE_6__.Cl)((0,tslib__WEBPACK_IMPORTED_MODULE_6__.Cl)({},this.props),{name:"wrapperCustomStyle",id:n,themeCss:c}))),style:d},react__WEBPACK_IMPORTED_MODULE_0__.createElement(amis_core__WEBPACK_IMPORTED_MODULE_1__.IcF,{unMountOnHidden:s,placeholder:"...",component:function(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"".concat(i,"Chart-content"),ref:_.refFn})}}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(amis_core__WEBPACK_IMPORTED_MODULE_1__.z4D,(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Cl)({},this.props,{config:{wrapperCustomStyle:c,id:n,themeCss:l,classNames:[{key:"baseControlClassName"}]},env:E})))},e.defaultProps={replaceChartOption:!1,unMountOnHidden:!1},e.propsList=[],e}(react__WEBPACK_IMPORTED_MODULE_0__.Component),ChartRenderer=function(_){function e(e,t){var r=_.call(this,e)||this;return t.registerComponent(r),r}return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.C6)(e,_),e.prototype.componentWillUnmount=function(){_.prototype.componentWillUnmount.call(this),this.context.unRegisterComponent(this)},e.prototype.setData=function(_,e){var t=this.props.store;t.updateData(_,void 0,e),this.renderChart(this.props.config,t.data)},e.prototype.getData=function(){return this.props.store.data},e.contextType=amis_core__WEBPACK_IMPORTED_MODULE_1__.MzX,(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Cg)([(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.A49)({type:"chart",storeType:amis_core__WEBPACK_IMPORTED_MODULE_1__.DtI.name}),(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Sn)("design:paramtypes",[Object,Object])],e)}(Chart)}}]);