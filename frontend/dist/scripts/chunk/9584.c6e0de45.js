"use strict";(self.webpackChunktestAmis=self.webpackChunktestAmis||[]).push([[9584],{69584:function(t,e,n){n.r(e),n.d(e,{OfficeViewerRenderer:function(){return l},default:function(){return a}});var r=n(31635),i=n(96540),o=n(8096),s=n(65408),a=function(t){function e(e){var n=t.call(this,e)||this;return n.rootElement=i.createRef(),n.state={loading:!1},n}return(0,r.C6)(e,t),e.prototype.componentDidMount=function(){var t;(null===(t=this.rootElement)||void 0===t?void 0:t.current)&&this.renderWord()},e.prototype.componentDidUpdate=function(t){var e,n,r=this;if(!this.state.loading){var i=this.props;(0,o.B92)(t.src,i.src,t.data,i.data)&&this.fetchWord().then((function(){r.renderWord()})),i.name&&t.data[i.name]!==i.data[i.name]&&this.renderWord(),JSON.stringify(t.wordOptions)===JSON.stringify(i.wordOptions)&&t.display===i.display||this.renderWord(),(null===(e=i.wordOptions)||void 0===e?void 0:e.enableVar)&&(i.trackExpression&&(0,o.pbD)(i.trackExpression,i.data)!==(0,o.pbD)(t.trackExpression,t.data)?this.renderWord():null===(n=this.office)||void 0===n||n.updateVariable())}},e.prototype.doAction=function(t,e,n,r){var i,o,s=null==t?void 0:t.actionType;"saveAs"===s&&(null===(i=this.office)||void 0===i||i.download((null==r?void 0:r.name)||this.fileName)),"print"===s&&(null===(o=this.office)||void 0===o||o.print())},e.prototype.evalVar=function(t,e){var n=this.props.data;return(0,o.GvO)("${"+t+"}",(0,o.ed2)(e,n),"| raw")},e.prototype.renderWord=function(){return(0,r.sH)(this,void 0,void 0,(function(){var t,e,n;return(0,r.YH)(this,(function(r){switch(r.label){case 0:return t=this.props,e=t.src,n=t.name,e?this.document?[3,2]:[4,this.fetchWord()]:[3,4];case 1:r.sent(),r.label=2;case 2:return[4,this.renderRemoteWord()];case 3:return r.sent(),[3,5];case 4:n&&this.renderFormFile(),r.label=5;case 5:return[2]}}))}))},e.prototype.fetchWord=function(){var t;return(0,r.sH)(this,void 0,void 0,(function(){var e,n,i,s,a,l,c,d;return(0,r.YH)(this,(function(r){switch(r.label){case 0:if(e=this.props,n=e.env,i=e.src,s=e.data,a=e.translate,"string"==typeof(c=i?(0,o.GvO)(i,s,"| raw"):void 0)?(l=c,this.fileName=l.split("/").pop()):"object"==typeof c&&"string"==typeof c.value&&(l=c.value,this.fileName=c.name||l.split("/").pop()),!l)return console.warn("file src is empty"),[2];this.finalSrc=l,this.setState({loading:!0}),r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,n.fetcher(l,s,{responseType:"arraybuffer"})];case 2:return d=r.sent(),this.document=d.data,[3,5];case 3:return r.sent(),(null===(t=this.rootElement)||void 0===t?void 0:t.current)&&(this.rootElement.current.innerHTML=a("loadingFailed")+" url:"+l),[3,5];case 4:return this.setState({loading:!1}),[7];case 5:return[2]}}))}))},e.prototype.initOffice=function(t,e){return(0,r.sH)(this,void 0,void 0,(function(){var n,i,o,s,a;return(0,r.YH)(this,(function(l){switch(l.label){case 0:return n=this.props,i=n.wordOptions,o=n.excelOptions,n.env,n.src,s=n.data,n.translate,[4,(0,t.createOfficeViewer)(e||this.document,{},this.finalSrc)];case 1:return(a=l.sent())instanceof t.Word?(a.updateOptions((0,r.Cl)((0,r.Cl)({},i),{data:s,evalVar:this.evalVar.bind(this)})),[3,4]):[3,2];case 2:return a instanceof t.Excel?(a.updateOptions((0,r.Cl)((0,r.Cl)({},o),{data:s,evalVar:this.evalVar.bind(this)})),[4,a.loadExcel()]):[3,4];case 3:l.sent(),l.label=4;case 4:return[2,a]}}))}))},e.prototype.renderRemoteWord=function(){return(0,r.sH)(this,void 0,void 0,(function(){var t,e,i=this;return(0,r.YH)(this,(function(o){return(t=this.props).wordOptions,t.excelOptions,t.env,t.src,t.data,e=t.display,t.translate,this.document?(n.e(5021).then(n.bind(n,55021)).then((function(t){return(0,r.sH)(i,void 0,void 0,(function(){var n,i,o;return(0,r.YH)(this,(function(r){switch(r.label){case 0:return[4,this.initOffice(t)];case 1:return n=r.sent(),!1!==e?n.render(null===(i=this.rootElement)||void 0===i?void 0:i.current):!1===e&&(null===(o=this.rootElement)||void 0===o?void 0:o.current)&&(this.rootElement.current.innerHTML=""),this.office=n,this.setState({loading:!1}),[2]}}))}))})),[2]):[2]}))}))},e.prototype.renderFormFile=function(){var t=this;this.setState({loading:!0});var e=this.props;e.wordOptions;var i=e.name,o=e.data,s=e.display,a=o[i];if(a instanceof File){var l=new FileReader;l.onload=function(e){var i=l.result;n.e(5021).then(n.bind(n,55021)).then((function(e){return(0,r.sH)(t,void 0,void 0,(function(){var t,n,o;return(0,r.YH)(this,(function(r){switch(r.label){case 0:return[4,this.initOffice(e,i)];case 1:return t=r.sent(),!1!==s?t.render(null===(n=this.rootElement)||void 0===n?void 0:n.current):!1===s&&(null===(o=this.rootElement)||void 0===o?void 0:o.current)&&(this.rootElement.current.innerHTML=""),this.office=t,this.setState({loading:!1}),[2]}}))}))}))},l.readAsArrayBuffer(a)}else this.setState({loading:!1})},e.prototype.render=function(){var t=this.props,e=t.classnames;t.translate;var n=t.className,r=t.loading,o=void 0!==r&&r,a=t.src,l=t.name,c=t.display,d=t.loadingConfig;return i.createElement("div",null,!1!==c&&!a&&!l&&i.createElement("svg",{width:"100%",height:"100",xmlns:"http://www.w3.org/2000/svg"},i.createElement("rect",{x:"0",y:"0",width:"100%",height:"100",style:{fill:"#F7F7F9"}}),i.createElement("text",{x:"50%",y:"50%",fontSize:"18",textAnchor:"middle",alignmentBaseline:"middle",fontFamily:"monospace, sans-serif",fill:"#555555"},"office viewer")),i.createElement("div",{ref:this.rootElement,className:e("office-viewer",n)}),i.createElement(s.y$,{overlay:!0,key:"info",show:o&&this.state.loading,loadingConfig:d}))},e}(i.Component),l=function(t){function e(e,n){var r=t.call(this,e)||this;return n.registerComponent(r),r}return(0,r.C6)(e,t),e.prototype.componentWillUnmount=function(){var e;null===(e=t.prototype.componentWillUnmount)||void 0===e||e.call(this),this.context.unRegisterComponent(this)},e.contextType=o.MzX,(0,r.Cg)([(0,o.A49)({type:"office-viewer"}),(0,r.Sn)("design:paramtypes",[Object,Object])],e)}(a)}}]);