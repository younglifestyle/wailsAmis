"use strict";(self.webpackChunktestAmis=self.webpackChunktestAmis||[]).push([[4455],{94455:function(e,t,n){n.r(t),n.d(t,{TableControlRenderer:function(){return b},default:function(){return v}});var i=n(31635),s=n(96540),a=n(8096),r=n(65408),o=n(90179),l=n.n(o),d=n(7309),u=n.n(d),c=n(38221),h=n.n(c),p=n(95093),m=n.n(p),f="__isPlaceholder",v=function(e){function t(t){var n=e.call(this,t)||this;n.entityId=1,n.subForms={},n.subFormItems={},n.rowPrinstine=[],n.editting={},n.toDispose=[],n.lazyEmitValue=h()(n.emitValue.bind(n),50,{trailing:!0,leading:!1}),n.emittedValue=null;var i=t.addHook;return n.state={columns:n.buildColumns(t),editIndex:"",items:Array.isArray(t.value)?t.value.concat():[]},n.entries=new a.NH2,n.buildItemProps=n.buildItemProps.bind(n),n.confirmEdit=n.confirmEdit.bind(n),n.cancelEdit=n.cancelEdit.bind(n),n.handleSaveTableOrder=n.handleSaveTableOrder.bind(n),n.handleTableSave=n.handleTableSave.bind(n),n.handleRadioChange=n.handleRadioChange.bind(n),n.getEntryId=n.getEntryId.bind(n),n.subFormRef=n.subFormRef.bind(n),n.subFormItemRef=n.subFormItemRef.bind(n),n.handlePageChange=n.handlePageChange.bind(n),n.emitValue=n.emitValue.bind(n),n.tableRef=n.tableRef.bind(n),n.flush=n.flush.bind(n),i&&n.toDispose.push(i(n.flush,"flush")),n}return(0,i.C6)(t,e),t.prototype.componentDidUpdate=function(e,t){var n=this.props,s=null;if(e.disabled!==n.disabled||e.static!==n.static||n.$schema.disabled!==e.$schema.disabled||n.$schema.static!==e.$schema.static){var a=this.state.items.filter((function(e){return!e.hasOwnProperty(f)}));s=(0,i.Cl)((0,i.Cl)({},s),{items:a,editIndex:"",columns:this.buildColumns(n)})}n.columns!==e.columns&&(s=(0,i.Cl)((0,i.Cl)({},s),{columns:this.buildColumns(n)})),n.value!==e.value&&n.value!==this.emittedValue&&(s=(0,i.Cl)((0,i.Cl)({},s),{items:Array.isArray(n.value)?n.value.concat():[],editIndex:""})),s&&this.setState(s)},t.prototype.componentWillUnmount=function(){this.entries.dispose(),this.lazyEmitValue.cancel(),this.toDispose.forEach((function(e){return e()})),this.toDispose=[]},t.prototype.flush=function(){return(0,i.sH)(this,void 0,void 0,(function(){var e,t,n=this;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return e=[],Object.keys(this.subForms).forEach((function(t){return n.subForms[t]&&e.push(n.subForms[t])})),[4,Promise.all(e.map((function(e){return e.flush()})))];case 1:return i.sent(),t=[],Object.keys(this.subFormItems).forEach((function(e){return n.subFormItems[e]&&t.push(n.subFormItems[e])})),[4,Promise.all(t.map((function(e){var t,n;return null===(n=(t=e.props).onFlushChange)||void 0===n?void 0:n.call(t)})))];case 2:return i.sent(),[4,this.lazyEmitValue.flush()];case 3:return i.sent(),[2]}}))}))},t.prototype.resolveVariableProps=function(e,t){var n={minLength:0,maxLength:1/0},i=e[t];if(!i)return n[t];if("string"==typeof i)if((0,a.joH)(i)){var s=(0,a.GvO)(i,e.data,"| raw");i="number"==typeof s&&s>=0?s:n[t]}else{var r=parseInt(i,10);i=isNaN(r)?n[t]:r}return i},t.prototype.subFormRef=function(e,t,n){this.subForms["".concat(t,"-").concat(n)]=e},t.prototype.subFormItemRef=function(e,t,n){this.subFormItems["".concat(t,"-").concat(n)]=e},t.prototype.validate=function(){return(0,i.sH)(this,void 0,void 0,(function(){var e,t,n,s,r,o,l,d,u,c,h,p=this;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return e=this.props,t=e.value,n=e.translate,s=e.columns,r=this.resolveVariableProps(this.props,"minLength"),o=this.resolveVariableProps(this.props,"maxLength"),this.state.editIndex?[2,n("Table.editing")]:r&&(!Array.isArray(t)||t.length<r)?[2,n("Combo.minLength",{minLength:r})]:[3,1];case 1:return o&&Array.isArray(t)&&t.length>o?[2,n("Combo.maxLength",{maxLength:o})]:[3,2];case 2:return l=[],Object.keys(this.subForms).forEach((function(e){return p.subForms[e]&&l.push(p.subForms[e])})),l.length?[4,Promise.all(l.map((function(e){return e.validate()})))]:[3,4];case 3:if(d=i.sent(),u=~d.indexOf(!1)?n("Form.validateFailed"):"",c="",!u&&Array.isArray(s)&&Array.isArray(t)&&s.some((function(e){if(e.unique&&e.name){var n=[];return t.some((function(t){var i=(0,a.dnO)(t,e.name);return~n.indexOf(i)?(c="".concat(e.label||e.name),!0):(n.push(i),!1)}))}return!1}))&&(u=n("InputTable.uniqueError",{label:c})),u)return[2,u];i.label=4;case 4:return h=[],Object.keys(this.subFormItems).forEach((function(e){return p.subFormItems[e]&&h.push(p.subFormItems[e])})),[4,Promise.all(h.map((function(e){return e.props.onValidate()})))];case 5:return[2,~i.sent().indexOf(!1)?n("Form.validateFailed"):""]}}))}))},t.prototype.emitValue=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,s;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return t=null!=e?e:this.state.items.filter((function(e){return!e.hasOwnProperty(f)})),n=this.props.onChange,[4,this.dispatchEvent("change")];case 1:return(s=i.sent())||(this.emittedValue=t,null==n||n(t)),[2,s]}}))}))},t.prototype.doAction=function(e,t){for(var n,s,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];return(0,i.sH)(this,void 0,void 0,(function(){var o,l,d,c,h,p,m,v,b,y,I,C,g,x,E,w,P,A=this;return(0,i.YH)(this,(function(k){switch(k.label){case 0:return o=this.props,l=o.onAction,d=o.valueField,c=o.env,h=o.needConfirm,p=o.addable,m=o.addApi,v=o.translate,b=o.onChange,"add"!==(y=e.actionType)?[3,6]:!1===p?[2]:(I=this.state.items.concat(),m||e.payload?(C=null,(0,a.Amo)(m,t)?[4,c.fetcher(m,t)]:[3,2]):[3,4]);case 1:return(g=k.sent())&&!g.ok?(!(null==m?void 0:m.silent)&&c.notify("error",null!==(s=null===(n=null==m?void 0:m.messages)||void 0===n?void 0:n.failed)&&void 0!==s?s:g.msg||v("fetchFailed")),[2]):(g&&g.ok&&(C=g.data),[3,3]);case 2:C=(0,a.nd1)(e.payload,t),k.label=3;case 3:return(C=Array.isArray(C)?C:[C]).forEach((function(e){d&&u()(I,(function(t){return t[d]==e[d]}))||(I.push(e),!1!==h&&Reflect.set(e,f,!0))})),this.setState({items:I},(function(){1===C.length&&!1!==h?A.startEdit("".concat(I.length-1),!0):null==b||b(I)})),[2];case 4:return[2,this.addItem("".concat(I.length-1),!1)];case 5:return[3,7];case 6:if("remove"===y||"delete"===y)return d?e.payload?(x=this.state.items.concat(),E=(0,a.nd1)(e.payload,t),(E=Array.isArray(E)?E:[E]).forEach((function(e){var t=(0,a.iXH)(x,(function(t){return t[d]==e[d]}));(null==t?void 0:t.length)&&(x=(0,a.Z6D)(x,t,1))})),this.setState({items:x},(function(){null==b||b(x)})),[2]):[2,c.alert(v("Table.playload"))]:[2,c.alert(v("Table.valueField"))];"initDrag"===y?(w=this.table).doAction.apply(w,(0,i.fX)([e,t],(0,i.zs)(r),!1)):"cancelDrag"===y&&(P=this.table).doAction.apply(P,(0,i.fX)([e,t],(0,i.zs)(r),!1)),k.label=7;case 7:return[2,l&&l.apply(void 0,(0,i.fX)([e,t],(0,i.zs)(r),!1))]}}))}))},t.prototype.copyItem=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,s,r,o,l,d,u,c,h,p,m,v=this;return(0,i.YH)(this,(function(b){return t=this.props,n=t.needConfirm,s=t.data,r=t.copyData,o=void 0===r?{"&":"$$"}:r,l=this.state.items.concat(),d=e.split(".").map((function(e){return parseInt(e,10)})),(u=d.concat())[u.length-1]+=1,c=l,h=(0,a.Jvj)(l,d),p=(0,a.nd1)(o,(0,a.ed2)(s,h)),l=!1===n?(0,a.Z6D)(l,u,0,p):(0,a.Z6D)(l,u,0,(0,i.Cl)((0,i.Cl)({},p),((m={})[f]=!0,m))),this.reUseRowId(l,c,u),this.setState({items:l},(function(){return(0,i.sH)(v,void 0,void 0,(function(){return(0,i.YH)(this,(function(e){switch(e.label){case 0:return[4,this.dispatchEvent("add",{index:u[u.length-1],indexPath:u.join("."),item:p})];case 1:return e.sent()||(!1===n?this.emitValue():this.startEdit(u.join("."),!0)),[2]}}))}))})),[2]}))}))},t.prototype.addItem=function(e,t,n){return void 0===t&&(t=!0),(0,i.sH)(this,void 0,void 0,(function(){var s,r,o,l,d,u,c,h,p,v,b,y=this;return(0,i.YH)(this,(function(I){return e=e||"".concat(this.state.items.length-1),s=this.props,r=s.needConfirm,o=s.scaffold,l=s.columns,d=s.data,u=this.state.items.concat(),(b={})[f]=!0,c=b,Array.isArray(l)&&l.forEach((function(e){if(void 0!==e.value&&"string"==typeof e.name)if(!("type"in e)||"input-date"!==e.type&&"input-datetime"!==e.type&&"input-time"!==e.type&&"input-month"!==e.type&&"input-quarter"!==e.type&&"input-year"!==e.type)(0,a.BHS)(e.value)||(0,a.BBb)(c,e.name,e.value);else if("string"!=typeof e.value||""!==e.value.trim()){var t=(0,a.PO2)(e.value,d,e.format||"X");(0,a.BBb)(c,e.name,(e.utc?m().utc(t):t).format(e.format||"X"))}})),c=(0,i.Cl)((0,i.Cl)({},c),o),!1===r&&Reflect.deleteProperty(c,f),h=e.split(".").map((function(e){return parseInt(e,10)})),(p=h.concat())[p.length-1]+=1,v=u,u=(0,a.Z6D)(u,p,0,c),this.reUseRowId(u,v,p),this.setState((0,i.Cl)({items:u},!1===r?{}:{editIndex:p.join("."),isCreateMode:!0,columns:this.buildColumns(this.props,!0,"".concat(e))}),(function(){return(0,i.sH)(y,void 0,void 0,(function(){return(0,i.YH)(this,(function(e){switch(e.label){case 0:return t?[4,this.dispatchEvent("add",{index:p[p.length-1],indexPath:p.join("."),item:c})]:[3,2];case 1:e.sent(),e.label=2;case 2:return!1===r&&this.emitValue(),null==n||n(),[2]}}))}))})),[2,!1]}))}))},t.prototype.subAddItem=function(e,t,n){return void 0===t&&(t=!0),(0,i.sH)(this,void 0,void 0,(function(){return(0,i.YH)(this,(function(i){return[2,this.addItem(e+".-1",t,(function(){null==n||n.setExpanded(!0)}))]}))}))},t.prototype.editItem=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,s;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return t=this.state.items,n=e.split(".").map((function(e){return parseInt(e,10)})),s=(0,a.Jvj)(t,n),[4,this.dispatchEvent("edit",{index:n[n.length-1],indexPath:n.join("."),item:s})];case 1:return!i.sent()&&this.startEdit(e,!0),[2]}}))}))},t.prototype.dispatchEvent=function(e,t){return void 0===t&&(t={}),(0,i.sH)(this,void 0,void 0,(function(){var n,s,r;return(0,i.YH)(this,(function(o){switch(o.label){case 0:return n=this.props.dispatchEvent,s=this.state.items,[4,n(e,(0,a.RKM)(this.props,(0,i.Cl)({value:(0,i.fX)([],(0,i.zs)(s),!1)},t)))];case 1:return[2,!!(null==(r=o.sent())?void 0:r.prevented)]}}))}))},t.prototype.startEdit=function(e,t){void 0===t&&(t=!1),this.setState({editIndex:e,isCreateMode:t,columns:this.buildColumns(this.props,t,e)})},t.prototype.confirmEdit=function(){var e,t,n;return(0,i.sH)(this,void 0,void 0,(function(){var s,r,o,l,d,u,c,h,p,m,v,b,y,I,C,g,x,E,w=this;return(0,i.YH)(this,(function(P){switch(P.label){case 0:return s=this.props,r=s.addApi,o=s.updateApi,l=s.data,d=s.env,u=s.translate,c=[],Object.keys(this.subForms).forEach((function(e){return w.subForms[e]&&c.push(w.subForms[e])})),c.forEach((function(e){return e.flush()})),h=[],Object.keys(this.subFormItems).forEach((function(e){return w.subFormItems[e]&&h.push(w.subFormItems[e])})),h.forEach((function(e){var t,n;return null===(n=(t=e.props).onFlushChange)||void 0===n?void 0:n.call(t)})),p=c,[4,Promise.all(p.map((function(e){return e.validate()})).concat(h.map((function(e){return e.props.onValidate()}))))];case 1:return~P.sent().indexOf(!1)?[2]:(m=this.state.items.concat(),v=this.state.editIndex.split(".").map((function(e){return parseInt(e,10)})),b=(0,i.Cl)({},(0,a.Jvj)(m,v)),y=b.hasOwnProperty(f),I=y?"addConfirm":"editConfirm",[4,this.dispatchEvent(I,{index:v[v.length-1],indexPath:v.join("."),item:b})]);case 2:return P.sent()?[2]:(C=null,g=void 0,y&&(0,a.Amo)(r,(0,a.ed2)(l,b))?[4,d.fetcher(r,(0,a.ed2)(l,b))]:[3,4]);case 3:return C=P.sent(),g=null===(e=null==r?void 0:r.messages)||void 0===e?void 0:e.failed,[3,6];case 4:return(0,a.Amo)(o,(0,a.ed2)(l,b))?[4,d.fetcher(o,(0,a.ed2)(l,b))]:[3,6];case 5:C=P.sent(),g=null===(t=null==o?void 0:o.messages)||void 0===t?void 0:t.failed,P.label=6;case 6:return C&&!C.ok?(!(null===(n=y?r:o)||void 0===n?void 0:n.silent)&&d.notify("error",null!=g?g:C.msg||u("saveFailed")),x=y?"addFail":"editFail",this.dispatchEvent(x,{index:v[v.length-1],indexPath:v.join("."),item:b,error:C}),[2]):(C&&C.ok&&(b=(0,i.Cl)((0,i.Cl)({},(y?r:o).replaceData?{}:b),C.data)),Reflect.deleteProperty(b,f),E=m,m=(0,a.Z6D)(m,v,1,b),this.reUseRowId(m,E,v),this.setState({editIndex:"",items:m,columns:this.buildColumns(this.props)},(function(){return(0,i.sH)(w,void 0,void 0,(function(){var e;return(0,i.YH)(this,(function(t){switch(t.label){case 0:return[4,this.emitValue()];case 1:return t.sent()||(e=y?"addSuccess":"editSuccess",this.dispatchEvent(e,{index:v[v.length-1],indexPath:v.join("."),item:b})),[2]}}))}))})),[2])}}))}))},t.prototype.cancelEdit=function(){var e=this.state.items.concat(),t=this.state.lastModifiedRow,n=this.state.editIndex.split(".").map((function(e){return parseInt(e,10)})),s=(0,i.Cl)({},(0,a.Jvj)(e,n)),r=e;s.hasOwnProperty(f)?e=(0,a.Z6D)(e,n,1):t&&~(null==t?void 0:t.index)&&(0,a.Gvm)(null==t?void 0:t.data)&&(e=(0,a.Z6D)(e,n,1,(0,i.Cl)((0,i.Cl)({},s),t.data))),this.reUseRowId(e,r,n),this.setState({editIndex:"",items:e,columns:this.buildColumns(this.props),lastModifiedRow:void 0},this.emitValue)},t.prototype.removeItem=function(e){var t,n;return(0,i.sH)(this,void 0,void 0,(function(){var s,r,o,l,d,u,c,h,p,m,f,v,b,y=this;return(0,i.YH)(this,(function(I){switch(I.label){case 0:return s=this.props,r=s.value,s.onChange,o=s.deleteApi,l=s.deleteConfirmText,d=s.env,u=s.data,c=s.translate,h=Array.isArray(r)?r.concat():[],p=e.split(".").map((function(e){return parseInt(e,10)})),(m=(0,a.Jvj)(h,p))?[4,this.dispatchEvent("delete",{index:p[p.length-1],indexPath:p.join("."),item:m})]:[2];case 1:return I.sent()?[2]:(f=(0,a.ed2)(u,m),(0,a.Amo)(o,f)?[4,d.confirm(l?(0,a.pbD)(l,f):c("deleteConfirm"))]:[3,4]);case 2:return I.sent()?[4,d.fetcher(o,f)]:[2];case 3:if(!(v=I.sent()).ok)return!(null==o?void 0:o.silent)&&d.notify("error",null!==(n=null===(t=null==o?void 0:o.messages)||void 0===t?void 0:t.failed)&&void 0!==n?n:c("deleteFailed")),this.dispatchEvent("deleteFail",{index:p[p.length-1],indexPath:p.join("."),item:m,error:v}),[2];I.label=4;case 4:return this.removeEntry(m),b=h,h=(0,a.Z6D)(h,p,1),this.reUseRowId(h,b,p),this.setState({items:h},(function(){return(0,i.sH)(y,void 0,void 0,(function(){return(0,i.YH)(this,(function(e){switch(e.label){case 0:return[4,this.emitValue(h)];case 1:return e.sent()||this.dispatchEvent("deleteSuccess",{value:h,index:p[p.length-1],indexPath:p.join("."),item:m}),[2]}}))}))})),[2]}}))}))},t.prototype.rowPathPlusOffset=function(e,t){void 0===t&&(t=0);var n=e.split(".").map((function(e){return parseInt(e,10)}));return n[0]+=t,n.join(".")},t.prototype.reUseRowId=function(e,t,n){for(var i=t,s=e,a=0,r=n.length;a<r;a++){var o=n[a];if(!(null==i?void 0:i[o])||!(null==s?void 0:s[o]))break;this.entries.set(s[o],this.entries.get(i[o])||this.entityId++),this.entries.delete(i[o]),s=s[o].children,i=i[o].children}},t.prototype.buildItemProps=function(e,t){var n={},i=this.resolveVariableProps(this.props,"minLength"),s=this.resolveVariableProps(this.props,"maxLength");if(n.inputTableCanAddItem=!s||s>this.state.items.length,n.inputTableCanRemoveItem=!i||i<this.state.items.length,!1===this.props.needConfirm)return n.quickEditEnabled=!0,n;if(!this.props.editable&&!this.props.addable&&!this.state.isCreateMode)return n;var a=this.props.perPage,r=this.state.page||1,o=0;return"number"==typeof a&&a&&(o=(r-1)*a),n.quickEditEnabled=this.state.editIndex===this.rowPathPlusOffset(e.path,o),n},t.prototype.buildColumns=function(e,t,n){var o=this;void 0===t&&(t=!1);var d=this.props,u=d.env,c=d.enableStaticTransform,h=d.mobileUI,p=d.testIdBuilder,m=Array.isArray(e.columns)?e.columns.concat():[],v=this.props.classPrefix,b=this.props.translate,y=this.props.needConfirm,I=this.props.showIndex,C=this.props.static,g=this.props.disabled,x=[];if(!C&&e.addable&&!1!==e.showTableAddBtn&&x.push({children:function(t){var n=t.key,i=t.rowIndex,a=t.rowIndexPath,l=t.offset,d=t.inputTableCanAddItem;return o.state.editIndex&&!1!==y||!d?null:s.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("Table.addRow"),tooltipContainer:e.popOverContainer||u.getModalContainer,disabled:g,onClick:o.addItem.bind(o,o.rowPathPlusOffset(a,l),void 0,void 0),testIdBuilder:null==p?void 0:p.getChild("addRow-".concat(i+l))},e.addBtnIcon?s.createElement(r.In,{cx:e.classnames,icon:e.addBtnIcon,className:"icon"}):null,e.addBtnLabel?s.createElement("span",null,e.addBtnLabel):null)}}),!C&&e.childrenAddable&&!1!==e.showTableAddBtn&&x.push({children:function(t){var n=t.key,i=t.rowIndex,a=t.rowIndexPath,l=t.offset,d=t.row;return o.state.editIndex&&!1!==y?null:s.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("Table.subAddRow"),tooltipContainer:e.popOverContainer||u.getModalContainer,disabled:g,onClick:o.subAddItem.bind(o,o.rowPathPlusOffset(a,l),void 0,d),testIdBuilder:null==p?void 0:p.getChild("subAddRow-".concat(i+l))},e.subAddBtnIcon?s.createElement(r.In,{cx:e.classnames,icon:e.subAddBtnIcon,className:"icon"}):null,e.subAddBtnLabel?s.createElement("span",null,e.subAddBtnLabel):null)}}),!C&&e.copyable&&!1!==e.showCopyBtn&&x.push({children:function(t){var n=t.key,i=t.rowIndex,a=t.rowIndexPath,l=t.offset;return o.state.editIndex&&!1!==y?null:s.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("Table.copyRow"),tooltipContainer:e.popOverContainer||u.getModalContainer,disabled:g,onClick:o.copyItem.bind(o,o.rowPathPlusOffset(a,l),void 0),testIdBuilder:null==p?void 0:p.getChild("copyRow-".concat(i+l))},e.copyBtnIcon?s.createElement(r.In,{cx:e.classnames,icon:e.copyBtnIcon,className:"icon"}):null,e.copyBtnLabel?s.createElement("span",null,e.copyBtnLabel):null)}}),!1===e.needConfirm?m=m.map((function(e){var t=e.quickEdit;return!1===t?l()(e,["quickEdit"]):(0,i.Cl)((0,i.Cl)({},e),"operation"===e.type?{}:{quickEdit:(0,i.Cl)((0,i.Cl)((0,i.Cl)({},o.columnToQuickEdit(e)),t),{visibleOn:"",hiddenOn:"",visible:!0,hidden:!1,saveImmediately:!0,mode:"inline",disabled:g,static:C||e.static})})})):!0!==C&&(e.addable||e.editable||t)?(m=m.map((function(s,r){var d=!t&&s.hasOwnProperty("quickEditOnUpdate")?s.quickEditOnUpdate:s.quickEdit,u=(0,a.CXN)(null==s?void 0:s.type);return(0,i.Cl)((0,i.Cl)({},!1===d?l()(s,["quickEdit"]):(0,i.Cl)((0,i.Cl)({},s),{quickEdit:(0,i.Cl)((0,i.Cl)((0,i.Cl)({},o.columnToQuickEdit(s)),d),{visibleOn:"",hiddenOn:"",visible:!0,hidden:!1,isQuickEditFormMode:!!(null==u?void 0:u.isFormItem),saveImmediately:!0,mode:"inline",disabled:g})})),c&&!1!==e.needConfirm?{staticOn:"".concat(!t," || data.index !== '").concat(n,"'")}:{})})),!C&&e.editable&&x.push({children:function(t){var n=t.key,i=t.rowIndex,a=t.rowIndexPath,l=t.data,d=t.offset;return o.state.editIndex||l&&l.hasOwnProperty(f)?null:s.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("Table.editRow"),tooltipContainer:e.popOverContainer||u.getModalContainer,disabled:g,onClick:function(){return o.editItem(o.rowPathPlusOffset(a,d))},testIdBuilder:null==p?void 0:p.getChild("editRow-".concat(i+d))},void 0!==e.updateBtnIcon?e.updateBtnIcon?s.createElement(r.In,{cx:e.classnames,icon:e.updateBtnIcon,className:"icon"}):null:e.editBtnIcon?s.createElement(r.In,{cx:e.classnames,icon:e.editBtnIcon,className:"icon"}):null,e.updateBtnLabel||e.editBtnLabel?s.createElement("span",null,e.updateBtnLabel||e.editBtnLabel):null)}}),!C&&x.push({children:function(t){var n=t.key,i=t.rowIndex,a=t.rowIndexPath,l=t.offset;return o.state.editIndex===o.rowPathPlusOffset(a,l)?s.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("save"),tooltipContainer:e.popOverContainer||u.getModalContainer,onClick:o.confirmEdit,testIdBuilder:null==p?void 0:p.getChild("confirmRow-".concat(i+l))},e.confirmBtnIcon?s.createElement(r.In,{cx:e.classnames,icon:e.confirmBtnIcon,className:"icon"}):null,e.confirmBtnLabel?s.createElement("span",null,e.confirmBtnLabel):null):null}}),!C&&x.push({children:function(t){var n=t.key,i=t.rowIndex,a=t.rowIndexPath,l=t.offset;return o.state.editIndex===o.rowPathPlusOffset(a,l)?s.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("cancel"),tooltipContainer:e.popOverContainer||u.getModalContainer,onClick:o.cancelEdit,testIdBuilder:null==p?void 0:p.getChild("cancelRow-".concat(i+l))},e.cancelBtnIcon?s.createElement(r.In,{cx:e.classnames,icon:e.cancelBtnIcon,className:"icon"}):null,e.cancelBtnLabel?s.createElement("span",null,e.cancelBtnLabel):null):null}})):m=m.map((function(e){var t=(0,a.CXN)(null==e?void 0:e.type);return(null==t?void 0:t.isFormItem)?(0,i.Cl)((0,i.Cl)({},e),{quickEdit:(0,i.Cl)((0,i.Cl)({},e),{visibleOn:"",hiddenOn:"",visible:!0,hidden:!1,isFormMode:!0})}):e})),!C&&e.removable&&x.push({children:function(t){var n=t.key,i=t.rowIndex,a=t.rowIndexPath,l=t.data,d=t.offset,c=t.inputTableCanRemoveItem;return(o.state.editIndex||l&&l.hasOwnProperty(f))&&!1!==y||!c?null:s.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("Table.deleteRow"),tooltipContainer:e.popOverContainer||u.getModalContainer,disabled:g,onClick:o.removeItem.bind(o,o.rowPathPlusOffset(a,d)),testIdBuilder:null==p?void 0:p.getChild("delRow-".concat(i+d))},e.deleteBtnIcon?s.createElement(r.In,{cx:e.classnames,icon:e.deleteBtnIcon,className:"icon"}):null,e.deleteBtnLabel?s.createElement("span",null,e.deleteBtnLabel):null)}}),x.length){var E=m.find((function(e){return"operation"===e.type}));E||(E={type:"operation",buttons:[],label:b("Table.operation"),className:"v-middle nowrap",fixed:h?"":"right",width:150,innerClassName:"m-n"},m.push(E)),E.buttons=Array.isArray(E.buttons)?E.buttons.concat():[],E.buttons.unshift.apply(E.buttons,x),E.hasOwnProperty("quickEdit")&&delete E.quickEdit}return I&&m.unshift({label:b("Table.index"),width:50,children:function(e){var t=e.rowIndexPath.split(".").map((function(e){return parseInt(e,10)+1}));return t[0]+=e.offset,s.createElement("td",{className:e.className},e.cellPrefix,s.createElement("span",null,t.join(".")),e.cellAffix)}}),m},t.prototype.columnToQuickEdit=function(e){var t;return(null===(t=(0,a.CXN)(null==e?void 0:e.type))||void 0===t?void 0:t.isFormItem)||~["group"].indexOf(e.type)?(0,i.Cl)((0,i.Cl)({},e),{label:""}):{type:"input-text"}},t.prototype.handleTableSave=function(e,t,n){var s,r=this;this.setState((function(t,o){var l={},d=o.perPage,u=t.editIndex,c=t.lastModifiedRow;if(u){var h=u.split(".").map((function(e){return parseInt(e,10)})),p=t.items.concat(),m=(0,a.Jvj)(p,h);if(!m)return l;var v=(0,i.Cl)({},e),b=p;return p=(0,a.Z6D)(p,h,1,v),r.reUseRowId(p,b,h),Object.assign(l,(0,i.Cl)({items:p},(null==c?void 0:c.index)===u?{}:{lastModifiedRow:m.hasOwnProperty(f)?void 0:{index:u,data:(0,i.Cl)({},m)}})),l}var y=t.page,I=t.items.concat();if(Array.isArray(e))n.forEach((function(t,n){var s=t.split(".").map((function(e){return parseInt(e,10)}));y&&y>1&&"number"==typeof d&&(s[0]+=(y-1)*d);var r=(0,i.Cl)({},(0,a.Jvj)(e,s));I=(0,a.Z6D)(I,s,1,r)}));else{h=n.split(".").map((function(e){return parseInt(e,10)})),y&&y>1&&"number"==typeof d&&(h[0]+=(y-1)*d);var C=(0,i.Cl)({},e);b=I,I=(0,a.Z6D)(I,h,1,C),r.reUseRowId(I,b,h)}return Object.assign(l,{items:I}),s=r.lazyEmitValue,l}),(function(){s&&s()}))},t.prototype.handleRadioChange=function(e,t){var n,s=this,r=t.name,o=t.row,l=t.trueValue,d=void 0===l||l,u=t.falseValue,c=void 0!==u&&u;return this.setState((function(e,t){var l=o.path,u=(0,a.X$u)(e.items,(function(e,t,n,s,a){var o;return(0,i.Cl)((0,i.Cl)({},e),((o={})[r]=l===a.join(".")?d:c,o))}));return n=e.editIndex==o.path?void 0:s.lazyEmitValue,{items:u}}),(function(){null==n||n()})),!1},t.prototype.handleSaveTableOrder=function(e,t){(0,this.props.onChange)(t.map((function(e){return(0,i.Cl)({},e)})))},t.prototype.handlePageChange=function(e){this.setState({page:e})},t.prototype.handlePristineChange=function(e,t){var n=this,s=this.props,r=s.needConfirm,o=s.perPage,l=t.split(".").map((function(e){return parseInt(e,10)}));this.setState((function(t){var s=t.items.concat(),r=t.page;r&&r>1&&"number"==typeof o&&(l[0]+=(r-1)*o);var d=(0,a.Jvj)(s,l),u=(0,i.Cl)((0,i.Cl)({},d),e),c=s;return s=(0,a.Z6D)(s,l,1,u),n.reUseRowId(s,c,l),{items:s}}),(function(){!1===r&&n.emitValue()}))},t.prototype.removeEntry=function(e){this.entries.has(e)&&this.entries.delete(e)},t.prototype.getEntryId=function(e){return this.entries.has(e)||this.entries.set(e,this.entityId++),String(this.entries.get(e))},t.prototype.tableRef=function(e){for(;e&&e.getWrappedInstance;)e=e.getWrappedInstance();this.table=e},t.prototype.computedAddBtnDisabled=function(){return this.props.disabled||!!this.state.editIndex},t.prototype.render=function(){var e=this,t=this.props,n=t.className;t.style,t.value;var a=t.disabled,r=t.render,o=t.placeholder,l=t.draggable,d=t.addable,u=t.columnsTogglable,c=t.combineNum,h=t.combineFromIndex,p=t.translate,m=t.canAccessSuperData,f=t.expandConfig,v=t.affixRow,b=t.prefixRow,y=t.formInited,I=t.perPage,C=t.classnames,g=t.rowClassName,x=t.rowClassNameExpr,E=t.affixHeader,w=void 0!==E&&E,P=t.autoFillHeight,A=void 0!==P&&P,k=t.tableContentClassName,B=t.static,F=t.showFooterAddBtn,O=t.footerAddBtn,R=t.toolbarClassName,H=t.onEvent,S=t.testIdBuilder,T=this.resolveVariableProps(this.props,"maxLength");if(!1===y)return null;var j=this.state.items,D=!1,N=this.state.page||1,V=0,L=1;"number"==typeof I&&I&&j.length>I&&(N>(L=Math.ceil(j.length/I))&&(N=L),j=j.slice((N-1)*I,N*I),D=!0,V=(N-1)*I);var z=!B&&d&&!1!==F&&(!T||T>this.state.items.length);return s.createElement("div",{className:C("InputTable",n)},r("body",{type:"table",placeholder:p(o),columns:this.state.columns,affixHeader:w,prefixRow:b,affixRow:v,autoFillHeight:A,tableContentClassName:k,onEvent:H},{ref:this.tableRef,value:void 0,saveImmediately:!0,disabled:a,draggable:l&&!this.state.editIndex,items:j,getEntryId:this.getEntryId,reUseRow:"match",onSave:this.handleTableSave,onRadioChange:this.handleRadioChange,onSaveOrder:this.handleSaveTableOrder,buildItemProps:this.buildItemProps,quickEditFormRef:this.subFormRef,quickEditFormItemRef:this.subFormItemRef,columnsTogglable:u,combineNum:c,combineFromIndex:h,expandConfig:f,canAccessSuperData:m,offset:V,rowClassName:g,rowClassNameExpr:x,onPristineChange:this.handlePristineChange,testIdBuilder:null==S?void 0:S.getChild("table")}),z||D?s.createElement("div",{className:C("InputTable-toolbar",R)},z?r("button",(0,i.Cl)({type:"button",level:"primary",size:"sm",label:p("Table.add"),icon:"fa fa-plus",disabledTip:p("Table.addButtonDisabledTip")},O||{}),{disabled:this.computedAddBtnDisabled(),onClick:function(){return e.addItem()},testIdBuilder:null==S?void 0:S.getChild("add")}):null,D?r("pager",{type:"pagination"},{activePage:N,perPage:I,total:this.state.items.length,onPageChange:this.handlePageChange,className:"InputTable-pager",testIdBuilder:null==S?void 0:S.getChild("page")}):null):null)},t.defaultProps={placeholder:"placeholder.empty",scaffold:{},addBtnIcon:"plus",subAddBtnIcon:"sub-plus",copyBtnIcon:"copy",editBtnIcon:"pencil",deleteBtnIcon:"minus",confirmBtnIcon:"check",cancelBtnIcon:"close",valueField:"",minLength:0,maxLength:1/0,showFooterAddBtn:!0,showTableAddBtn:!0},t.propsList=["onChange","name","columns","label","scaffold","showTableAddBtn","addable","removable","copyable","editable","addApi","updateApi","deleteApi","needConfirm","canAccessSuperData","formStore","footerActions","toolbarClassName"],(0,i.Cg)([a.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object,String]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"handlePristineChange",null),t}(s.Component),b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.C6)(t,e),t.prototype.setData=function(e,t,n,s){return(0,i.sH)(this,void 0,void 0,(function(){var t,r,o,l=this;return(0,i.YH)(this,(function(d){switch(d.label){case 0:return this.state.items.length,void 0===n?[3,1]:(t=(0,i.fX)([],(0,i.zs)(this.state.items),!1),String(n).split(",").forEach((function(n){var i=n.split(".").map((function(e){return parseInt(e,10)}));t=(0,a.Z6D)(t,i,1,e)})),this.setState({items:t},(function(){l.emitValue()})),[3,4]);case 1:return void 0===s?[3,3]:(r=(0,i.fX)([],(0,i.zs)(this.state.items),!1),o=[],(0,a.IFF)(r,(function(t,n,d,u,c){return o.unshift((function(){return(0,i.sH)(l,void 0,void 0,(function(){return(0,i.YH)(this,(function(o){switch(o.label){case 0:return[4,(0,a.JnN)(s,t)];case 1:return o.sent()&&(r=(0,a.Z6D)(r,(0,i.fX)((0,i.fX)([],(0,i.zs)(c),!1),[n],!1),1,e)),[2]}}))}))})),!0})),[4,Promise.all(o.map((function(e){return e()})))]);case 2:return d.sent(),this.setState({items:r},(function(){l.emitValue()})),[3,4];case 3:this.setState({items:(0,i.fX)([],(0,i.zs)(e),!1)},(function(){l.emitValue()})),d.label=4;case 4:return[2]}}))}))},t.prototype.doAction=function(t,n,s,r){var o,l,d,c,h,p,m;return void 0===s&&(s=!1),(0,i.sH)(this,void 0,void 0,(function(){var f,v,b,y,I,C,g,x,E,w,P,A,k,B,F,O,R,H,S,T,j,D,N,V=this;return(0,i.YH)(this,(function(L){switch(L.label){case 0:return f=this.props,v=f.valueField,b=f.env,y=f.needConfirm,f.addable,I=f.addApi,C=f.deleteApi,g=f.resetValue,x=f.translate,E=f.onChange,w=f.formStore,P=f.store,A=f.name,k=t.actionType,B=(null===(o=this.props.store)||void 0===o?void 0:o.data)||{},"addItem"!==k?[3,6]:(F=this.state.items.concat(),I||r?(O=null,(0,a.Amo)(I,B)?[4,b.fetcher(I,B)]:[3,2]):[3,4]);case 1:return(j=L.sent())&&!j.ok?(!(null==I?void 0:I.silent)&&b.notify("error",null!==(d=null===(l=null==I?void 0:I.messages)||void 0===l?void 0:l.failed)&&void 0!==d?d:j.msg||x("fetchFailed")),[2]):(j&&j.ok&&(O=j.data),[3,3]);case 2:O=r.item,L.label=3;case 3:return O=(Array.isArray(O)?O:[O]).filter((function(e){return!v||!u()(F,(function(t){return t[v]==e[v]}))})),R=[],"string"==typeof r.index&&/^\d+(\.\d+)*$/.test(r.index)?R=r.index.split(".").map((function(e){return parseInt(e,10)})):"number"==typeof r.index&&(R=[r.index]),R.length?F=a.Z6D.apply(void 0,(0,i.fX)([F,R,0],(0,i.zs)(O),!1)):F.push.apply(F,(0,i.fX)([],(0,i.zs)(O),!1)),this.setState({items:F},(function(){if(1===O.length&&!1!==y){var e=R.concat();e[e.length-1]+=1,V.startEdit(e.join("."),!0)}else null==E||E(F)})),[2];case 4:return[2,this.addItem("".concat(F.length-1),!1)];case 5:return[3,13];case 6:return"deleteItem"!==k?[3,12]:(H=(0,i.fX)([],(0,i.zs)(this.state.items),!1),S=[],void 0===(null==r?void 0:r.index)?[3,7]:(String(r.index).split(",").forEach((function(e){var t=e.split(".").map((function(e){return parseInt(e,10)}));S.push((0,a.Jvj)(H,t)),H=(0,a.Z6D)(H,t,1)})),[3,9]));case 7:return void 0===(null==r?void 0:r.condition)?[3,9]:(T=[],(0,a.IFF)(H,(function(e,t,n,s,o){return T.unshift((function(){return(0,i.sH)(V,void 0,void 0,(function(){return(0,i.YH)(this,(function(n){switch(n.label){case 0:return[4,(0,a.JnN)(null==r?void 0:r.condition,e)];case 1:return n.sent()&&(S.push(e),H=(0,a.Z6D)(H,(0,i.fX)((0,i.fX)([],(0,i.zs)(o),!1),[t],!1),1)),[2]}}))}))})),!0})),[4,T.reduce((function(e,t){return e.then(t)}),Promise.resolve())]);case 8:L.sent(),L.label=9;case 9:return(0,a.Amo)(C,(0,a.ed2)(B,{deletedItems:S}))?[4,b.fetcher(C,(0,a.ed2)(B,{deletedItems:S}))]:[3,11];case 10:if((j=L.sent())&&!j.ok)return!(null==C?void 0:C.silent)&&b.notify("error",null!==(h=null===(c=null==C?void 0:C.messages)||void 0===c?void 0:c.failed)&&void 0!==h?h:j.msg||x("fetchFailed")),[2];L.label=11;case 11:return this.setState({items:H},(function(){null==E||E(H)})),[2];case 12:if("clear"===k)return this.setState({items:[]},(function(){null==E||E([])})),[2];if("reset"===k)return D=null!==(m=(0,a.dnO)(null!==(p=null==w?void 0:w.pristine)&&void 0!==p?p:null==P?void 0:P.pristine,A))&&void 0!==m?m:g,N=Array.isArray(D)?D:[],this.setState({items:N},(function(){null==E||E(N)})),[2];L.label=13;case 13:return[2,e.prototype.doAction.call(this,t,n,s,B)]}}))}))},(0,i.Cg)([(0,a.eIh)({type:"input-table"})],t)}(v)}}]);