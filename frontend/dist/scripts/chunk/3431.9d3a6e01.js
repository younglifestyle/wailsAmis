"use strict";(self.webpackChunktestAmis=self.webpackChunktestAmis||[]).push([[3431],{23431:function(e,t,a){a.r(t),a.d(t,{SubFormControlRenderer:function(){return v},default:function(){return C}});var n,l=a(31635),o=a(96540),i=a(8096),r=a(32485),s=a.n(r),d=a(90179),p=a.n(d),c=a(44383),m=a.n(c),u=a(65408),h=a(10246),g=a(40961),b=function(e){return e?((n=n||document.createElement("div")).innerHTML=e,n.innerText):e},C=function(e){function t(t){var a=e.call(this,t)||this;return a.state={},a.id=(0,i.OsD)(),a.addItem=a.addItem.bind(a),a.removeItem=a.removeItem.bind(a),a.editSingle=a.editSingle.bind(a),a.open=a.open.bind(a),a.close=a.close.bind(a),a.dragTipRef=a.dragTipRef.bind(a),a.handleDialogConfirm=a.handleDialogConfirm.bind(a),a}return(0,l.C6)(t,e),t.prototype.addItem=function(){this.setState({dialogData:(0,i.ed2)(this.props.data,this.props.scaffold||{}),dialogCtx:{mode:"add"}})},t.prototype.removeItem=function(e){e.stopPropagation(),e.preventDefault();var t=parseInt(e.currentTarget.getAttribute("data-index"),10),a=this.props.value;Array.isArray(a)&&((a=a.concat()).splice(t,1),this.props.onChange(a))},t.prototype.editSingle=function(){this.props.value?this.setState({dialogData:(0,i.ed2)(this.props.data,this.props.value),dialogCtx:{mode:"edit"}}):this.addItem()},t.prototype.open=function(e){var t=parseInt(e.currentTarget.getAttribute("data-index"),10),a=this.props.value;Array.isArray(a)&&a[t]&&(this.tempValue=a[t],this.setState({dialogData:(0,i.ed2)(this.props.data,a[t]),dialogCtx:{mode:"edit",index:t}}))},t.prototype.close=function(){this.setState({dialogData:void 0,dialogCtx:void 0})},t.prototype.handleDialogConfirm=function(e){var t=this.props,a=t.multiple,n=t.onChange,o=t.value,i=this.state.dialogCtx;if(a){var r=Array.isArray(o)?o.concat():[];"add"===(null==i?void 0:i.mode)?r.push((0,l.Cl)({},e[0])):r[i.index]=(0,l.Cl)((0,l.Cl)({},r[i.index]),e[0]),n(r)}else n((0,l.Cl)((0,l.Cl)({},o),e[0]));this.close()},t.prototype.handlePopupConfirm=function(){var e=this.tempValue,t=this.props,a=t.multiple,n=t.onChange,o=t.value,i=this.state.dialogCtx;if(a){var r=Array.isArray(o)?o.concat():[];"add"===(null==i?void 0:i.mode)?r.push((0,l.Cl)({},e)):r[i.index]=(0,l.Cl)((0,l.Cl)({},r[i.index]),e),n(r)}else n((0,l.Cl)((0,l.Cl)({},o),e));this.close()},t.prototype.dragTipRef=function(e){!this.dragTip&&e?this.initDragging():this.dragTip&&!e&&this.destroyDragging(),this.dragTip=e},t.prototype.initDragging=function(){var e=this,t=this.props.classPrefix,a=this.props.submitOnChange,n=(0,g.findDOMNode)(this);this.sortable=new h.Ay(n.querySelector(".".concat(t,"SubForm-values")),{group:"SubForm-".concat(this.id),animation:150,handle:".".concat(t,"SubForm-valueDragBar"),ghostClass:"".concat(t,"SubForm-value--dragging"),onEnd:function(t){if(t.newIndex!==t.oldIndex){var n=t.to;t.oldIndex<n.childNodes.length-1?n.insertBefore(t.item,n.childNodes[t.oldIndex>t.newIndex?t.oldIndex+1:t.oldIndex]):n.appendChild(t.item);var l=e.props.value;if(Array.isArray(l)){var o=l.concat();o.splice(t.newIndex,0,o.splice(t.oldIndex,1)[0]),e.props.onChange(o,a,!0)}}}})},t.prototype.destroyDragging=function(){this.sortable&&this.sortable.destroy()},t.prototype.buildDialogSchema=function(){var e=this.props.form,t=["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"];return(0,l.Cl)((0,l.Cl)({},m()(e,t)),{type:"dialog",body:(0,l.Cl)((0,l.Cl)({type:"form",canAccessSuperData:!1},p()(e,t)),{inheritData:!1})})},t.prototype.buildFormSchema=function(){var e=this.props.form;return(0,l.Cl)((0,l.Cl)({type:"form",canAccessSuperData:!1},p()(e,["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"])),{inheritData:!1})},t.prototype.renderMultipe=function(){var e=this,t=this.props,a=t.addButtonClassName,n=t.itemClassName,r=t.itemsClassName,s=t.disabled,d=t.maxLength,p=t.labelField,c=t.defaultLabel,m=t.value,h=t.btnLabel,g=t.render,C=t.data,v=t.translate,f=t.classnames,y=t.placeholder,S=t.draggable,N=t.draggableTip,I=t.addable,x=t.removable,E=t.minLength,F=t.addButtonText,D=t.testIdBuilder;return o.createElement(o.Fragment,null,Array.isArray(m)&&m.length?o.createElement("div",{className:f("SubForm-values",r),key:"values"},m.map((function(t,a){return o.createElement("div",(0,l.Cl)({className:f("SubForm-value",{"is-disabled":s},n),key:a},null==D?void 0:D.getChild("item-".concat(a)).getTestId()),S&&m.length>1?o.createElement("a",{className:f("SubForm-valueDragBar")},o.createElement(u.In,{icon:"drag-bar",className:f("icon")})):null,o.createElement("span",{className:f("SubForm-valueLabel")},h&&g("label",{type:"tpl",tpl:v(h)},{data:(0,i.ed2)(C,t)}),!h&&(t&&p&&t[p]&&b(t[p])||v(c))),o.createElement("a",{"data-index":a,onClick:e.open,className:f("SubForm-valueEdit")},o.createElement(u.In,{icon:"pencil",className:"icon"})),s||!1===x||E&&!(m.length>E)?null:o.createElement("a",{"data-index":a,className:f("SubForm-valueDel"),onClick:e.removeItem},o.createElement(u.In,{icon:"close",className:"icon"})))}))):o.createElement("div",{className:f("SubForm-placeholder"),key:"placeholder"},v(y||"placeholder.empty")),o.createElement("div",{key:"toolbar",className:f("SubForm-toolbar")},!1!==I?o.createElement("button",(0,l.Cl)({type:"button",onClick:this.addItem,className:f("Button SubForm-addBtn",a),disabled:s||!!(d&&Array.isArray(m)&&m.length>=d)},null==D?void 0:D.getChild("add-button").getTestId()),o.createElement(u.In,{icon:"plus",className:"icon"}),o.createElement("span",null,v(F||"SubForm.add"))):null,S&&Array.isArray(m)&&m.length>1?o.createElement("span",{className:f("Combo-dragableTip"),ref:this.dragTipRef},Array.isArray(m)&&m.length>1?v(N):""):null))},t.prototype.renderSingle=function(){var e=this.props,t=e.classnames,a=e.itemsClassName,n=e.itemClassName,r=e.disabled,s=e.value,d=e.labelField,p=e.defaultLabel,c=e.btnLabel,m=e.render,h=e.data,g=e.translate,C=e.testIdBuilder,v=null==C?void 0:C.getChild("edit-single");return o.createElement("div",{className:t("SubForm-values",a),key:"values"},o.createElement("div",(0,l.Cl)({className:t("SubForm-value",{"is-disabled":r},n),onClick:this.editSingle,"data-tooltip":g("SubForm.editDetail"),"data-position":"bottom"},null==v?void 0:v.getTestId()),o.createElement("span",{className:t("SubForm-valueLabel")},c&&m("label",{type:"tpl",tpl:g(c)},{data:(0,i.ed2)(h,s)}),!c&&(s&&d&&s[d]&&b(s[d])||g(p))),o.createElement("a",(0,l.Cl)({className:t("SubForm-valueEdit")},null==v?void 0:v.getChild("icon").getTestId()),o.createElement(u.In,{icon:"pencil",className:"icon"}))))},t.prototype.render=function(){var e=this,t=this.props,a=t.multiple,n=t.classPrefix,l=t.className;t.style;var i=t.render,r=t.mobileUI,d=t.env,p=t.popOverContainer,c=this.state.dialogData,m=this.state.dialogCtx;return o.createElement("div",{className:s()("".concat(n,"SubFormControl"),l)},a?this.renderMultipe():this.renderSingle(),r?o.createElement(u.HH,{isShow:!!m,showConfirm:!0,onConfirm:this.handlePopupConfirm,onHide:this.close,container:r?null==d?void 0:d.getModalContainer:p||d.getModalContainer},o.createElement("div",{className:"flex-1 pl-10 pr-10"},i("form",this.buildFormSchema(),{data:c,formStore:void 0,wrapWithPanel:!1,onChange:function(t){e.tempValue=t}}))):i("modal",this.buildDialogSchema(),{show:!!m,onClose:this.close,onConfirm:this.handleDialogConfirm,data:c,formStore:void 0}))},t.defaultProps={minLength:0,maxLength:0,multiple:!1,btnClassName:"",addButtonClassName:"",itemClassName:"",labelField:"label",defaultLabel:"SubForm.button",placeholder:"placeholder.empty"},t.propsList=["form","formStore"],(0,l.Cg)([i.d6t,(0,l.Sn)("design:type",Function),(0,l.Sn)("design:paramtypes",[]),(0,l.Sn)("design:returntype",void 0)],t.prototype,"handlePopupConfirm",null),t}(o.PureComponent),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,l.C6)(t,e),(0,l.Cg)([(0,i.eIh)({type:"input-sub-form",sizeMutable:!1,strictMode:!1})],t)}(C)}}]);