"use strict";(self.webpackChunktestAmis=self.webpackChunktestAmis||[]).push([[9743],{99743:function(e,t,n){n.r(t),n.d(t,{MatrixRenderer:function(){return u},default:function(){return a}});var r=n(31635),o=n(96540),i=n(8096),l=n(65408),s=n(66283),a=function(e){function t(t){var n=e.call(this,t)||this;return n.mounted=!1,n.toDispose=[],n.state={columns:t.columns||[],rows:t.rows||[],loading:!1},n.toggleItem=n.toggleItem.bind(n),n.reload=n.reload.bind(n),n.initOptions=n.initOptions.bind(n),n.mounted=!0,n}return(0,r.C6)(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.formInited,n=e.addHook,r=e.formItem;r&&this.toDispose.push(t||!n?r.addInitHook(this.initOptions):n(this.initOptions,"init"))},t.prototype.componentDidUpdate=function(e){var t=this.props;if(e.columns!==t.columns||e.rows!==t.rows)this.setState({columns:t.columns||[],rows:t.rows||[]});else if(t.formInited&&(t.source!==e.source||e.data!==t.data)){var n=(0,i.lSp)(e.source,e.data,{ignoreData:!0}),r=(0,i.lSp)(t.source,t.data,{ignoreData:!0});n.url!==r.url&&(0,i.FlT)(r.url)&&this.reload()}},t.prototype.componentWillUnmount=function(){this.mounted=!1,this.toDispose.forEach((function(e){return e()})),this.toDispose=[]},t.prototype.doAction=function(e,t,n){var r,o,l=this.props,s=l.resetValue,a=l.onChange,c=l.formStore,u=l.store,d=l.name,h=null==e?void 0:e.actionType;if("clear"===h)null==a||a("");else if("reset"===h){var p=null!==(o=(0,i.dnO)(null!==(r=null==c?void 0:c.pristine)&&void 0!==r?r:null==u?void 0:u.pristine,d))&&void 0!==o?o:s;null==a||a(null!=p?p:"")}},t.prototype.initOptions=function(e){return(0,r.sH)(this,void 0,void 0,(function(){var t,n,o;return(0,r.YH)(this,(function(r){switch(r.label){case 0:return[4,this.reload()];case 1:return r.sent(),t=this.props,n=t.formItem,o=t.name,n?(n.value&&(0,i.BBb)(e,o,n.value),[2]):[2]}}))}))},t.prototype.reload=function(){return(0,r.sH)(this,void 0,void 0,(function(){var e,t,n,o,l,s,a=this;return(0,r.YH)(this,(function(c){switch(c.label){case 0:if(e=this.props,t=e.source,n=e.data,o=e.env,l=e.onChange,s=e.translate,!(0,i.Amo)(t,n)||this.state.loading)return[2];if(!o||!o.fetcher)throw new Error("fetcher is required");return[4,new Promise((function(e,i){if(!a.mounted)return e();a.setState({loading:!0},(function(){if(!a.mounted)return e();o.fetcher(t,n).then((function(n){if(!n.ok)throw new Error(n.msg||s("fetchFailed"));if(!a.mounted)return e();a.setState({loading:!1,rows:n.data.rows||[],columns:n.data.columns||[]},(function(){t&&t.replaceData;var o=n.data.value;o&&(o=t.replaceData?o:function(e,t,n){return e.map((function(e,o){return e.map((function(e,i){return(0,r.Cl)((0,r.Cl)((0,r.Cl)({},t[o]),n[i]),e)}))}))}(o,a.state.columns,a.state.rows),l(o)),e()}))})).catch((function(t){return a.setState({error:t,loading:!1},(function(){return e()}))}))}))}))];case 1:return[2,c.sent()]}}))}))},t.prototype.toggleItem=function(e,t,n){return(0,r.sH)(this,void 0,void 0,(function(){var o,l,s,a,u,d,h,p,m,f,v,g,C;return(0,r.YH)(this,(function(k){switch(k.label){case 0:if(o=this.state,l=o.columns,s=o.rows,a=this.props,u=a.multiple,d=a.singleSelectMode,h=a.dispatchEvent,a.data,p=this.props.value||c(l,s),u)p[t][n]=(0,r.Cl)((0,r.Cl)({},p[t][n]),{checked:e});else if("row"===d)for(v=0,f=l.length;v<f;v++)p[v][n]=(0,r.Cl)((0,r.Cl)({},p[v][n]),{checked:t===v?e:!e});else if("column"===d)for(m=0,f=s.length;m<f;m++)p[t][m]=(0,r.Cl)((0,r.Cl)({},p[t][m]),{checked:n===m?e:!e});else for(m=0,f=s.length;m<f;m++)for(v=0,g=l.length;v<g;v++)p[v][m]=(0,r.Cl)((0,r.Cl)({},p[v][m]),{checked:t===v&&n===m?e:!e});return[4,h("change",(0,i.RKM)(this.props,{value:p.concat()}))];case 1:return(null==(C=k.sent())?void 0:C.prevented)||this.props.onChange(p.concat()),[2]}}))}))},t.prototype.isColumChecked=function(e,t){var n=e[t];return!!n&&n.some((function(e){return e&&e.checked}))},t.prototype.isColumnPartialChecked=function(e,t){var n=e[t];if(!n||1==n.length)return!1;var r=n[0].checked;return n.some((function(e){return e.checked!==r}))&&!n.every((function(e){return e.checked===r}))},t.prototype.toggleColumnCheckAll=function(e,t,n){return(0,r.sH)(this,void 0,void 0,(function(){var o,i;return(0,r.YH)(this,(function(r){switch(r.label){case 0:o=t[n],i=0,r.label=1;case 1:return i<o.length?[4,this.toggleItem(e,n,i)]:[3,4];case 2:r.sent(),r.label=3;case 3:return i++,[3,1];case 4:return[2]}}))}))},t.prototype.isRowChecked=function(e,t){return e&&e.some((function(e){return e[t]&&e[t].checked}))},t.prototype.isRowPartialChecked=function(e,t){if(!e||1==e.length)return!1;var n=e[0][t].checked;return e.some((function(e){return n!==e[t].checked}))&&!e.every((function(e){return e.checked}))},t.prototype.toggleRowCheckAll=function(e,t,n){return(0,r.sH)(this,void 0,void 0,(function(){var o;return(0,r.YH)(this,(function(r){switch(r.label){case 0:o=0,r.label=1;case 1:return o<t.length?[4,this.toggleItem(e,o,n)]:[3,4];case 2:r.sent(),r.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))},t.prototype.renderInput=function(e){var t=this;void 0===e&&(e=!1);var n=this.state,r=n.columns,s=n.rows,a=this.props,u=a.rowLabel,d=a.disabled,h=a.classnames,p=a.multiple,m=a.textAlign,f=a.xCheckAll,v=a.yCheckAll,g=a.testIdBuilder,C=this.props.value||c(r,s);return o.createElement("div",{className:h("Table m-b-none",{"is-mobile":(0,i.FrL)()})},o.createElement("div",{className:h("Table-content")},o.createElement("table",{className:h("Table-table")},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",null,u),r.map((function(n,r){return o.createElement("th",{key:r,className:"text-"+(m||p?"left":"center")},p&&v?o.createElement(l.Sc,{type:"checkbox",disabled:e||d,checked:t.isColumChecked(C,r),partial:t.isColumnPartialChecked(C,r),onChange:function(e){return t.toggleColumnCheckAll(e,C,r)}}):null,n.label)})))),o.createElement("tbody",null,s.map((function(n,i){return o.createElement("tr",{key:i},o.createElement("td",null,p&&f?o.createElement(l.Sc,{type:"checkbox",disabled:e||d,checked:t.isRowChecked(C,i),partial:t.isRowPartialChecked(C,i),onChange:function(e){return t.toggleRowCheckAll(e,C,i)},testIdBuilder:null==g?void 0:g.getChild(i)}):null,n.label,n.description||n.desc?o.createElement("span",{className:"m-l-xs text-muted text-xs"},n.description||n.desc):null),r.map((function(n,r){return o.createElement("td",{key:r,className:"text-"+(m||p?"left":"center")},o.createElement(l.Sc,{type:p?"checkbox":"radio",disabled:e||d,checked:!!(C[r]&&C[r][i]&&C[r][i].checked),onChange:function(e){return t.toggleItem(e,r,i)},testIdBuilder:null==g?void 0:g.getChild("".concat(r,"-").concat(i))}))})))}))))))},t.prototype.renderStatic=function(e){void 0===e&&(e="-");var t=this.props,n=t.className;t.render;var r=t.classnames,i=this.state.error;return o.createElement("div",{key:"input",className:r("MatrixControl",n||"")},i?e:this.renderInput(!0))},t.prototype.render=function(){var e=this.props,t=e.className;e.render;var n=e.classnames,r=e.loadingConfig,i=this.state,s=i.error,a=i.loading;return o.createElement("div",{key:"input",className:n("MatrixControl",t||"")},s?o.createElement("div",{className:n("MatrixControl-error Alert Alert--danger")},String(s)):this.renderInput(),o.createElement(l.y$,{size:"lg",overlay:!0,key:"info",show:a,loadingConfig:r}))},t.defaultProps={columns:[],rows:[],multiple:!0,singleSelectMode:"column"},(0,r.Cg)([(0,s.E)(),(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[]),(0,r.Sn)("design:returntype",void 0)],t.prototype,"render",null),t}(o.Component);function c(e,t){return Array.isArray(e)||(e=[]),Array.isArray(t)||(t=[]),e.map((function(e){return t.map((function(t){return(0,r.Cl)((0,r.Cl)((0,r.Cl)({},t),e),{checked:!1})}))}))}var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.C6)(t,e),(0,r.Cg)([(0,i.eIh)({type:"matrix-checkboxes",strictMode:!1,sizeMutable:!1})],t)}(a)}}]);