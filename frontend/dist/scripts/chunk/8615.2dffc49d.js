"use strict";(self.webpackChunktestAmis=self.webpackChunktestAmis||[]).push([[8615],{58615:function(e,t,n){n.r(t),n.d(t,{TreeSelectControlRenderer:function(){return c},default:function(){return h}});var o=n(31635),i=n(96540),r=n(8096),a=n(65408),l=n(51545),s=n(38221),p=n.n(s),d=n(40961),u=n(66283),h=function(e){function t(t){var n=e.call(this,t)||this;return n.container=i.createRef(),n.input=i.createRef(),n.cache={},n.targetRef=function(e){return n.target=e?(0,d.findDOMNode)(e):null},n.sourceLoaded=!1,n.state={inputValue:"",tempValue:"",isOpened:!1},n.open=n.open.bind(n),n.close=n.close.bind(n),n.handleChange=n.handleChange.bind(n),n.handleTempChange=n.handleTempChange.bind(n),n.handleConfirm=n.handleConfirm.bind(n),n.clearValue=n.clearValue.bind(n),n.handleFocus=n.handleFocus.bind(n),n.handleBlur=n.handleBlur.bind(n),n.handleKeyPress=n.handleKeyPress.bind(n),n.handleInputChange=p()(n.handleInputChange.bind(n),150,{trailing:!0,leading:!1}),n.handleInputKeyDown=n.handleInputKeyDown.bind(n),n.loadRemote=p()(n.loadRemote.bind(n),250,{trailing:!0,leading:!1}),n}return(0,o.C6)(t,e),t.prototype.componentDidMount=function(){this.loadRemote("")},t.prototype.componentWillUnmount=function(){this.sourceLoaded=!1},t.prototype.open=function(e){this.props.disabled||this.setState({isOpened:!0},e)},t.prototype.close=function(){var e=this;this.setState({isOpened:!1,inputValue:this.props.multiple?this.state.inputValue:""},(function(){return e.loadRemote(e.state.inputValue)}))},t.prototype.resolveOptions=function(){var e=this.props,t=e.options,n=e.searchable,o=e.autoComplete;return!(0,r.Amo)(o)&&n&&this.state.inputValue?this.filterOptions(t,this.state.inputValue):t},t.prototype.resolveOption=function(e,t){var n=this;return(0,r.cym)(e,(function(e){var o=n.props.valueField||"value";return((0,r.Bdw)(e,o)?e[o]:"")===t}))},t.prototype.handleFocus=function(e){var t=this.props,n=t.dispatchEvent,o=t.value,i=this.resolveOptions(),a=this.resolveOption(i,o);n("focus",(0,r.RKM)(this.props,{value:o,item:a,items:i}))},t.prototype.handleBlur=function(e){var t=this.props,n=t.dispatchEvent,o=t.value,i=this.resolveOptions(),a=this.resolveOption(i,o);n("blur",(0,r.RKM)(this.props,{value:o,item:a,items:i}))},t.prototype.handleKeyPress=function(e){" "===e.key&&e.shiftKey&&(this.handleOutClick(e),e.preventDefault())},t.prototype.validate=function(){var e=this.props,t=e.value,n=e.minLength,o=e.maxLength,i=e.delimiter,r=Array.isArray(t)?t:(t?String(t):"").split(i||",");return n&&r.length<n?"已选择数量低于设定的最小个数".concat(n,"，请选择更多的选项。"):o&&r.length>o?"已选择数量超出设定的最大个数".concat(o,"，请取消选择超出的选项。"):void 0},t.prototype.removeItem=function(e,t){var n=this.props,o=n.selectedOptions,i=n.joinValues,r=n.extractValue,a=n.delimiter,l=n.valueField,s=n.onChange,p=n.disabled;if(t&&t.stopPropagation(),!p){var d=o.concat();d.splice(e,1);var u=d;i?u=d.map((function(e){return e[l||"value"]})).join(a||","):r&&(u=d.map((function(e){return e[l||"value"]}))),s(u)}},t.prototype.handleChange=function(e){var t=this;this.props.multiple||this.close(),this.setState({inputValue:""},(function(){return t.resultChangeEvent(e)}))},t.prototype.handleTempChange=function(e){this.setState({tempValue:e})},t.prototype.handleConfirm=function(){var e=this;this.close(),this.setState({inputValue:""},(function(){return e.resultChangeEvent(e.state.tempValue)}))},t.prototype.handleInputChange=function(e){var t=this,n=this.props,o=n.autoComplete,i=n.data;this.setState({inputValue:e},(0,r.Amo)(o,i)?function(){return t.loadRemote(t.state.inputValue)}:void 0)},t.prototype.handleInputKeyDown=function(e){var t=this.state.inputValue,n=this.props,o=n.multiple,i=n.selectedOptions;"Backspace"===e.key&&!t&&i.length&&o&&this.removeItem(i.length-1)},t.prototype.resetValue=function(){var e,t,n=this.props,o=n.onChange,i=n.resetValue,a=n.formStore,l=n.store,s=n.name;o(null!==(t=(0,r.dnO)(null!==(e=null==a?void 0:a.pristine)&&void 0!==e?e:null==l?void 0:l.pristine,s))&&void 0!==t?t:i)},t.prototype.clearValue=function(){var e=this.props,t=e.onChange,n=e.resetValue;t(void 0===n?"":n)},t.prototype.filterOptions=function(e,t){var n=this,i=this.props,r=i.labelField,a=i.valueField;return e.map((function(e){if((e=(0,o.Cl)({},e)).visible=!!(0,l.Ht)([e],t,{keys:[r||"label",a||"value"],threshold:l.Ht.rankings.CONTAINS}).length,!e.visible&&e.children){e.children=n.filterOptions(e.children,t);var i=e.children.filter((function(e){return e.visible})).length;e.visible=!!i}return e.visible&&(e.collapsed=!1),e}))},t.prototype.loadRemote=function(e){return(0,o.sH)(this,void 0,void 0,(function(){var t,n,i,a,l,s,p,d,u,h;return(0,o.YH)(this,(function(c){switch(c.label){case 0:if(t=this.props,n=t.autoComplete,i=t.env,a=t.data,l=t.setOptions,s=t.setLoading,p=t.source,!(0,r.Amo)(n,a)||!e&&(0,r.Amo)(p)&&!this.sourceLoaded)return this.sourceLoaded=!0,[2];if(!i||!i.fetcher)throw new Error("fetcher is required");if(this.cache[e]||~e.indexOf("'"))return u=this.cache[e]||[],h=this.mergeOptions(u),l(h),[2,Promise.resolve({options:h})];s(!0),c.label=1;case 1:return c.trys.push([1,,3,4]),[4,i.fetcher(n,(0,o.Cl)((0,o.Cl)({},a),{term:e,value:e}))];case 2:return d=c.sent(),u=d.data&&d.data.options||d.data||[],this.cache[e]=u,h=this.mergeOptions(u),l(h),[2,{options:h}];case 3:return s(!1),[7];case 4:return[2]}}))}))},t.prototype.mergeOptions=function(e){var t=this.props.selectedOptions,n=(0,r.a5s)(e).concat();return Array.isArray(t)&&t.length&&t.forEach((function(e){(0,r.cym)(n,(function(t){return t.value==e.value}))||n.push((0,o.Cl)({},e))})),n},t.prototype.reload=function(){var e=this.props.reloadOptions;e&&e()},t.prototype.handleOutClick=function(e){e.defaultPrevented||this.setState({isOpened:!0})},t.prototype.handleResultChange=function(e){var t=this.props,n=t.joinValues,o=t.extractValue,i=t.delimiter,r=t.valueField,a=t.multiple,l=Array.isArray(e)?e.concat():[];a||l.length?((n||o)&&(l=e.map((function(e){return e[r||"value"]}))),n&&(l=l.join(i||",")),this.resultChangeEvent(l)):this.resultChangeEvent("")},t.prototype.doAction=function(e,t,n){var o,i,r,a,l;"clear"===e.actionType?this.clearValue():"reset"===e.actionType?this.resetValue():"add"===e.actionType?this.addItemFromAction(null===(o=e.args)||void 0===o?void 0:o.item,null===(i=e.args)||void 0===i?void 0:i.parentValue):"edit"===e.actionType?this.editItemFromAction(null===(r=e.args)||void 0===r?void 0:r.item,null===(a=e.args)||void 0===a?void 0:a.originValue):"delete"===e.actionType?this.deleteItemFromAction(null===(l=e.args)||void 0===l?void 0:l.value):"reload"===e.actionType&&this.reload()},t.prototype.addItemFromAction=function(e,t){var n=this.props,o=n.onAdd,i=n.options,a=n.valueField,l=(0,r.iXH)(i,(function(e){var n=a||"value";return((0,r.Bdw)(e,n)?e[n]:"")===t}))||[];o&&o(l.concat(0),e,!0)},t.prototype.editItemFromAction=function(e,t){var n=this.props,i=n.onEdit,r=n.options,a=this.resolveOption(r,t);i&&a&&i((0,o.Cl)((0,o.Cl)({},e),{originValue:t}),a,!0)},t.prototype.deleteItemFromAction=function(e){var t=this.props,n=t.onDelete,o=t.options,i=this.resolveOption(o,e);n&&i&&n(i)},t.prototype.resultChangeEvent=function(e){return(0,o.sH)(this,void 0,void 0,(function(){var t,n,i,a,l,s;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return t=this.props,n=t.onChange,i=t.dispatchEvent,a=this.resolveOptions(),l=this.resolveOption(a,e),[4,i("change",(0,r.RKM)(this.props,{value:e,item:l,items:this.resolveOptions()}))];case 1:return(null==(s=o.sent())?void 0:s.prevented)||n&&n(e),[2]}}))}))},t.prototype.renderOptionItem=function(e,t){var n=this.props,i=n.menuTpl,a=n.render,l=n.data;return a("option/".concat(t.index),i,{data:(0,r.ed2)((0,r.ed2)(l,(0,o.Cl)({},t)),e)})},t.prototype.renderItem=function(e){var t=this.props,n=t.labelField,o=t.options;if(t.hideNodePathLabel)return e[n||"label"];var i=(0,r.fw2)(o,e,!0);return"".concat(i?i.map((function(e){return"".concat(e[n||"label"])})).join(" / "):e[n||"label"])},t.prototype.domRef=function(e){this.treeRef=e},t.prototype.renderOuter=function(){var e=this.props,t=e.value,n=e.enableNodePath,o=e.pathSeparator,l=void 0===o?"/":o,s=e.disabled,p=e.joinValues,d=e.extractValue,u=e.delimiter;e.placeholder;var h=e.options,c=e.multiple,v=e.valueField,m=e.initiallyOpen,f=e.unfoldedLevel,g=e.withChildren,y=e.rootLabel,C=e.cascade,b=e.rootValue,O=e.showIcon,S=e.showRadio;e.popOverContainer;var V=e.onlyChildren,I=e.onlyLeaf,T=e.classPrefix,F=e.optionsPlaceholder,A=e.searchable,R=e.autoComplete,w=e.maxLength,P=e.minLength,E=e.labelField,L=e.deferField,x=e.nodePath,D=e.onAdd,j=e.creatable,k=e.createTip,K=e.addControls,H=e.onEdit,N=e.editable,B=e.editTip,M=e.editControls,U=e.removable,z=e.removeTip,W=e.onDelete,q=e.rootCreatable,Y=e.rootCreateTip,J=e.translate,Q=e.deferLoad,X=e.expandTreeOptions,$=e.selfDisabledAffectChildren,G=e.showOutline,Z=e.autoCheckChildren,_=e.hideRoot,ee=e.virtualThreshold,te=e.itemHeight,ne=e.menuTpl,oe=e.enableDefaultIcon,ie=e.mobileUI,re=e.testIdBuilder,ae=!(0,r.Amo)(R)&&A&&this.state.inputValue?this.filterOptions(h,this.state.inputValue):h;return i.createElement(a.PH,{classPrefix:T,onRef:this.domRef,onlyChildren:V,onlyLeaf:I,labelField:E,valueField:v,deferField:L,disabled:s,onChange:ie?this.handleTempChange:this.handleChange,joinValues:p,extractValue:d,delimiter:u,placeholder:J(F),options:ae,highlightTxt:this.state.inputValue,multiple:c,initiallyOpen:m,unfoldedLevel:f,withChildren:g,autoCheckChildren:Z,rootLabel:J(y),rootValue:b,showIcon:O,showRadio:S,showOutline:G,cascade:C,foldedField:"collapsed",hideRoot:_,value:t||"",nodePath:x,enableNodePath:n,pathSeparator:l,maxLength:w,minLength:P,onAdd:D,creatable:j,createTip:k,rootCreatable:q,rootCreateTip:Y,onEdit:H,editable:N,editTip:B,removable:U,removeTip:z,onDelete:W,bultinCUD:!K&&!M,onDeferLoad:Q,onExpandTree:X,selfDisabledAffectChildren:$,virtualThreshold:ee,itemHeight:(0,r.Roz)(te)>0?(0,r.Roz)(te):void 0,itemRender:ne?this.renderOptionItem:void 0,enableDefaultIcon:oe,mobileUI:ie,testIdBuilder:re})},t.prototype.render=function(){var e=this,t=this.props,n=t.className;t.style;var l=t.disabled,s=t.inline,p=t.loading,d=t.multiple;t.value;var u=t.clearable,h=t.classPrefix,c=t.classnames,v=t.searchable,m=t.autoComplete,f=t.selectedOptions,g=t.placeholder,y=t.popOverContainer,C=t.mobileUI,b=t.maxTagCount,O=t.overflowTagPopover,S=t.translate,V=t.env,I=t.loadingConfig,T=t.testIdBuilder,F=this.state.isOpened,A=d?f:f.length?this.renderItem(f[0]):"";return i.createElement("div",(0,o.Cl)({ref:this.container,className:c("TreeSelectControl",n)},null==T?void 0:T.getTestId()),i.createElement(a.dM,{popOverContainer:y||V.getModalContainer,maxTagCount:b,overflowTagPopover:O,disabled:l,ref:this.targetRef,placeholder:S(null!=g?g:"placeholder.empty"),inputPlaceholder:"",className:c("TreeSelect",{"TreeSelect--inline":s,"TreeSelect--single":!d,"TreeSelect--multi":d,"TreeSelect--searchable":v||(0,r.Amo)(m),"is-opened":this.state.isOpened,"is-disabled":l}),result:A,onResultClick:this.handleOutClick,value:this.state.inputValue,onChange:this.handleInputChange,onResultChange:this.handleResultChange,itemRender:this.renderItem,onKeyPress:this.handleKeyPress,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyDown:this.handleInputKeyDown,clearable:u,allowInput:!C&&(v||(0,r.Amo)(m))&&(d||!A),hasDropDownArrow:!0,readOnly:C,mobileUI:C,testIdBuilder:null==T?void 0:T.getChild("result-box")},p?i.createElement(a.y$,{loadingConfig:I,size:"sm"}):void 0),!C&&F?i.createElement(r.hJs,{container:y||function(){return e.container.current},target:function(){return e.target},show:!0},i.createElement(r.Kx3,{classPrefix:h,className:"".concat(h,"TreeSelect-popover"),style:{minWidth:this.target?this.target.offsetWidth:void 0},onHide:this.close,overlay:!0},this.renderOuter())):null,C?i.createElement(a.HH,{container:V.getModalContainer,className:c("".concat(h,"TreeSelect-popup")),isShow:F,onHide:this.close,showConfirm:!0,onConfirm:this.handleConfirm},this.renderOuter()):null)},t.defaultProps={hideRoot:!0,placeholder:"Select.placeholder",optionsPlaceholder:"placeholder.noData",multiple:!1,clearable:!0,rootLabel:"Tree.root",rootValue:"",showIcon:!0,joinValues:!0,extractValue:!1,delimiter:",",resetValue:"",hideNodePathLabel:!1,enableNodePath:!1,pathSeparator:"/",selfDisabledAffectChildren:!0},(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"handleOutClick",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Array]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"handleResultChange",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object,Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"addItemFromAction",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object,Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"editItemFromAction",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"deleteItemFromAction",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object]),(0,o.Sn)("design:returntype",Promise)],t.prototype,"resultChangeEvent",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object,Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"renderOptionItem",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"renderItem",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"domRef",null),(0,o.Cg)([(0,u.E)(),(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"render",null),t}(i.Component),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.C6)(t,e),(0,o.Cg)([(0,r.QqA)({type:"tree-select"})],t)}(h)}}]);