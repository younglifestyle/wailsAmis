"use strict";(self.webpackChunktestAmis=self.webpackChunktestAmis||[]).push([[9131],{79131:function(e,t,n){n.r(t),n.d(t,{TagControlRenderer:function(){return F},default:function(){return O}});var i=n(31635),a=n(96540),s=n(8096),o=n(27648),r=n(7309),l=n.n(r),u=n(64846),p=n.n(u),d=n(21283),c=n.n(d),h=n(83673),g=n.n(h),v=n(63375),m=n.n(v),y=n(40961),f=n(65408),S=n(66283),C=n(51545),O=function(e){function t(t){var n=e.call(this,t)||this;return n.input=a.createRef(),n.state={isOpened:!1,inputValue:"",isFocused:!1,selectedOptions:t.selectedOptions,cacheOptions:[]},n}return(0,i.C6)(t,e),t.prototype.componentDidUpdate=function(e){var t=this.props;e.value!==t.value&&this.setState({inputValue:""})},t.prototype.doAction=function(e,t,n){var i,a,o=this.props,r=o.resetValue,l=o.onChange,u=o.formStore,p=o.store,d=o.name,c=null==e?void 0:e.actionType;if("clear"===c)null==l||l("");else if("reset"===c){var h=null!==(a=(0,s.dnO)(null!==(i=null==u?void 0:u.pristine)&&void 0!==i?i:null==p?void 0:p.pristine,d))&&void 0!==a?a:r;null==l||l(null!=h?h:"")}},t.prototype.dispatchEvent=function(e,t){return void 0===t&&(t={}),(0,i.sH)(this,void 0,void 0,(function(){var n,a,o,r;return(0,i.YH)(this,(function(l){switch(l.label){case 0:return n=this.props,a=n.dispatchEvent,o=n.options,[4,a(e,(0,s.RKM)(this.props,(0,i.Cl)({options:o,items:o},t)))];case 1:return[2,!!(null==(r=l.sent())?void 0:r.prevented)]}}))}))},t.prototype.normalizeInputValue=function(e){var t=this.props,n=t.enableBatchAdd,a=t.separator,s=t.valueField,o=t.labelField,r=t.delimiter,l=[];if(n&&a&&"string"==typeof a)l=e.split(a);else{var u=m()(g()(e.split(r||",")));l.push.apply(l,(0,i.fX)([],(0,i.zs)(u),!1))}return l.filter(Boolean).map((function(e){var t;return(t={})["".concat(s||"value")]=e,t["".concat(o||"label")]=e,t}))},t.prototype.normalizeOptions=function(e){var t=this.props,n=t.joinValues,i=t.extractValue,a=t.delimiter,s=t.valueField;return n?e.map((function(e){return e[s||"value"]})).join(a||","):i?e.map((function(e){return e[s||"value"]})):e},t.prototype.normalizeMergedValue=function(e,t){void 0===t&&(t=!0);var n=this.props,i=n.selectedOptions,a=n.valueField,s=c()(i.concat(),this.normalizeInputValue(e),(function(e,t){return e[a||"value"]===t[a||"value"]}));return t?this.normalizeOptions(s):s},t.prototype.validateInputValue=function(e){var t=this.props,n=t.max,i=t.maxTagLength;t.enableBatchAdd,t.separator;var a=t.onInputValidateFailed,s=t.valueField,o=this.normalizeMergedValue(e,!1);if(null!=n&&p()(n)&&o.length>n)return null==a||a(o.map((function(e){return e[s||"value"]})),"max"),!1;var r=this.normalizeInputValue(e);return null==i||!p()(i)||!r.some((function(e){return e[s||"value"].length>i}))||(null==a||a(r.map((function(e){return e[s||"value"]})),"maxLength"),!1)},t.prototype.getValue=function(e,t,n){void 0===e&&(e="normal"),void 0===t&&(t={});var i=this.props,a=i.joinValues,s=i.extractValue,o=i.delimiter,r=i.valueField,l=(n=n||this.props.selectedOptions).concat();return"push"===e?l.push(t):"pop"===e&&l.pop(),a?l.map((function(e){return e[r||"value"]})).join(o||","):s?l.map((function(e){return e[r||"value"]})):l},t.prototype.addItem=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,a,s,o,r;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return this.isReachMax()?[2]:(t=this.props,n=t.selectedOptions,a=t.onChange,s=t.valueField,o=n.concat(),l()(o,(function(t){return t[s||"value"]==e[s||"value"]}))?[2]:(r=this.getValue("push",e),[4,this.dispatchEvent("change",{value:r,selectedItems:n.concat(e)})]));case 1:return i.sent()||a(r),[2]}}))}))},t.prototype.addItem2=function(e){var t=this.props,n=t.mobileUI,i=t.valueField,a=void 0===i?"value":i;if(n){var s=this.state.selectedOptions.concat(),o=s.findIndex((function(t){return t[a]===e[a]}));~o?s.splice(o,1):this.isReachMaxFromState()||s.push(e),this.setState({selectedOptions:s})}},t.prototype.isExist=function(e){var t=this.props,n=t.options,i=t.valueField,a=void 0===i?"value":i,s=this.state.cacheOptions;return n.some((function(t){return t[a]===e}))||s.some((function(t){return t[a]===e}))},t.prototype.addSelection=function(){var e=this.state.inputValue,t=this.props.maxTagLength,n=this.state.selectedOptions.slice(),i=this.state.cacheOptions.slice();if(void 0!==t&&(e=(e=e.trim()).slice(0,t)),!this.isExist(e)&&e&&!this.isReachMaxFromState()){var a=this.normalizeInputValue(e);n.push(a[0]),i.push(a[0]),this.setState({inputValue:"",selectedOptions:n,cacheOptions:i})}},t.prototype.onConfirm=function(){return(0,i.sH)(this,void 0,void 0,(function(){var e,t,n;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return e=this.state.selectedOptions,t=this.props.onChange,n=this.getValue("normal",{},e),[4,this.dispatchEvent("change",{value:n,selectedItems:e})];case 1:return i.sent()||t(n),this.close(),[2]}}))}))},t.prototype.handleFocus=function(e){var t,n;return(0,i.sH)(this,void 0,void 0,(function(){var a;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return this.setState({isFocused:!0,isOpened:!0,selectedOptions:this.props.selectedOptions}),a=this.getValue("normal"),[4,this.dispatchEvent("focus",{value:a,selectedItems:this.props.selectedOptions})];case 1:return i.sent()||null===(n=(t=this.props).onFocus)||void 0===n||n.call(t,e),[2]}}))}))},t.prototype.handleBlur=function(e){var t,n;return(0,i.sH)(this,void 0,void 0,(function(){var a,s,o,r,l,u,p;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return a=this.props,s=a.selectedOptions,o=a.onChange,r=a.mobileUI,l=a.options,r&&l.length?[2]:(u=this.state.inputValue.trim(),this.validateInputValue(u)?(p=this.normalizeMergedValue(u),[4,this.dispatchEvent("blur",{value:p,selectedItems:s})]):(this.setState({isFocused:!1,isOpened:!1}),[2]));case 1:return i.sent()||null===(n=(t=this.props).onBlur)||void 0===n||n.call(t,e),this.setState({isFocused:!1,isOpened:!1,inputValue:""},u?function(){s.length!==p.length&&(null==o||o(p))}:void 0),[2]}}))}))},t.prototype.close=function(){this.setState({isOpened:!1})},t.prototype.handleInputChange=function(e){this.setState({inputValue:e})},t.prototype.handleChange=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,a,s,o,r,l;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return t=this.props,n=t.joinValues,a=t.extractValue,s=t.delimiter,o=t.valueField,r=t.onChange,l=Array.isArray(e)?e.concat():[],(n||a)&&(l=e.map((function(e){return e[o||"value"]}))),n&&(l=l.join(s||",")),[4,this.dispatchEvent("change",{value:l,selectedItems:e})];case 1:return i.sent()||r(l),[2]}}))}))},t.prototype.renderItem=function(e){var t=this.props.labelField;return"".concat(e[t||"label"])},t.prototype.handleKeyDown=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,a,s,o,r,l,u;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return t=this.props,n=t.selectedOptions,a=t.onChange,s=t.delimiter,t.labelField,t.valueField,o=this.state.inputValue.trim(),r=n.concat(this.normalizeMergedValue(o,!1)),!n.length||o||"Backspace"!=e.key?[3,2]:(l=this.getValue("pop"),[4,this.dispatchEvent("change",{value:l,selectedItems:r})]);case 1:return(u=i.sent())||a(l),[3,5];case 2:return!o||"Enter"!==e.key&&e.key!==s?[3,4]:(e.preventDefault(),e.stopPropagation(),l=this.normalizeMergedValue(o),[4,this.dispatchEvent("change",{value:l,selectedItems:r})]);case 3:return u=i.sent(),this.validateInputValue(o)?(u||n.length===l.length||a(l),this.setState({inputValue:""}),[3,5]):(this.setState({isFocused:!1,isOpened:!1}),[2]);case 4:o||"Enter"!==e.key||this.handleBlur(e),i.label=5;case 5:return[2]}}))}))},t.prototype.handleOptionChange=function(e){this.props.mobileUI?this.addItem2(e):!this.isReachMax()&&e&&this.addItem(e)},t.prototype.getTarget=function(){return this.input.current},t.prototype.getParent=function(){return this.input.current&&(0,y.findDOMNode)(this.input.current).parentElement},t.prototype.reload=function(){var e=this.props.reloadOptions;null==e||e()},t.prototype.isReachMax=function(){var e=this.props,t=e.max,n=e.selectedOptions;return null!=t&&p()(t)&&n.length>=t},t.prototype.isReachMaxFromState=function(){var e=this.state.selectedOptions,t=this.props.max;return null!=t&&p()(t)&&e.length>=t},t.prototype.render=function(){var e=this,t=this.props,n=t.className;t.style;var r=t.classnames,l=t.disabled,u=t.placeholder,p=t.name,d=t.clearable,c=t.selectedOptions,h=t.loading,g=t.popOverContainer,v=t.dropdown,m=t.options,y=t.optionsTip,S=t.maxTagCount,O=t.overflowTagPopover,F=t.translate,I=t.loadingConfig,b=t.valueField,V=t.env,x=t.mobileUI,E=t.labelField,T=t.testIdBuilder,M=this.state.inputValue,w=Array.isArray(m)?(0,s.hVz)(m,(function(e,t,n,i){return void 0!==e[b||"value"]&&(x||!~c.indexOf(e))&&((0,C.Ht)([e].concat(i),M,{keys:[E||"label",b||"value"],threshold:C.Ht.rankings.CONTAINS}).length||Array.isArray(e.children)&&!!e.children.length)}),0,!0):[],H=this.isReachMax();return a.createElement(o.Ay,{selectedItem:c,isOpen:x?this.state.isOpened:this.state.isFocused,inputValue:this.state.inputValue,onChange:this.handleOptionChange,itemToString:this.renderItem},(function(t){var o=t.isOpen,C=t.highlightedIndex,E=t.getItemProps,M=t.getInputProps;return a.createElement("div",{className:r(n,"TagControl")},a.createElement(f.dM,(0,i.Cl)({},M({name:p,ref:e.input,placeholder:F(null!=u?u:"Tag.placeholder"),value:e.state.inputValue,onKeyDown:e.handleKeyDown,onFocus:x?void 0:e.handleFocus,onBlur:e.handleBlur,disabled:l}),{onResultClick:x?e.handleFocus:void 0,inputPlaceholder:"",onChange:e.handleInputChange,className:r("TagControl-input"),result:c,onResultChange:e.handleChange,itemRender:e.renderItem,clearable:d,maxTagCount:S,overflowTagPopover:O,popOverContainer:g||V.getModalContainer,allowInput:!x||x&&!(null==m?void 0:m.length),mobileUI:x,testIdBuilder:null==T?void 0:T.getChild("resule-box")}),h?a.createElement(f.y$,{loadingConfig:I,size:"sm"}):void 0),!1!==v?x?a.createElement(f.HH,{className:r("Tag-popup"),container:x?null==V?void 0:V.getModalContainer:g||V.getModalContainer,isShow:o&&!!w.length,showConfirm:!0,onConfirm:e.onConfirm,onHide:e.close},a.createElement("div",null,a.createElement(f.Kv,{selectedOptions:c,mobileUI:x,options:w.concat(e.state.cacheOptions),itemRender:e.renderItem,highlightIndex:C,getItemProps:function(t){var n=t.item,a=t.index;return(0,i.Cl)({},E({index:a,item:n,className:r("ListMenu-item",{"is-active":~(e.state.selectedOptions.map((function(e){return e[b]}))||[]).indexOf(n[b])})}))}}),x&&!e.isReachMaxFromState()?a.createElement("div",{className:r("ListMenu-add-wrap")},a.createElement(f.dM,{placeholder:F("placeholder.enter")+"...",allowInput:!0,value:e.state.inputValue,mobileUI:x,clearable:!0,maxTagCount:S,onChange:function(t){e.setState({inputValue:t})},onBlur:e.addSelection})):null)):a.createElement(s.hJs,{container:g||e.getParent,target:e.getTarget,placement:"auto",show:o&&!!w.length},a.createElement(s.Kx3,{overlay:!0,className:r("TagControl-popover"),onHide:e.close},a.createElement(f.Kv,{options:w,itemRender:e.renderItem,highlightIndex:C,testIdBuilder:null==T?void 0:T.getChild("options"),getItemProps:function(e){var t=e.item,n=e.index;return(0,i.Cl)({},E({index:n,item:t,disabled:H||t.disabled,className:r("ListMenu-item",{"is-disabled":H})}))}}))):a.createElement("div",{className:r("TagControl-sug")},y?a.createElement("div",{className:r("TagControl-sugTip")},F(y)):null,m.map((function(t,n){return a.createElement("div",{className:r("TagControl-sugItem",{"is-disabled":t.disabled||l||H}),key:n,onClick:e.addItem.bind(e,t)},t.label)}))))}))},t.defaultProps={resetValue:"",labelField:"label",valueField:"value",multiple:!0,placeholder:"Tag.placeholder",optionsTip:"Tag.tip",separator:"-"},(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[String,Object]),(0,i.Sn)("design:returntype",Promise)],t.prototype,"dispatchEvent",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[String,Object,Array]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"getValue",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"addSelection",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",Promise)],t.prototype,"onConfirm",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",Promise)],t.prototype,"handleFocus",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",Promise)],t.prototype,"handleBlur",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"close",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[String]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"handleInputChange",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Array]),(0,i.Sn)("design:returntype",Promise)],t.prototype,"handleChange",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",Object)],t.prototype,"renderItem",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",Promise)],t.prototype,"handleKeyDown",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"handleOptionChange",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"getTarget",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"getParent",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"isReachMax",null),(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"isReachMaxFromState",null),(0,i.Cg)([(0,S.E)(),(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"render",null),t}(a.PureComponent),F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.C6)(t,e),(0,i.Cg)([(0,s.QqA)({type:"input-tag"})],t)}(O)}}]);