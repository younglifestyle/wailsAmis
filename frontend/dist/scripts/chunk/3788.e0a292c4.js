"use strict";(self.webpackChunktestAmis=self.webpackChunktestAmis||[]).push([[3788],{33788:function(e,t,n){n.r(t),n.d(t,{ExcelControlRenderer:function(){return y},default:function(){return v}});var r=n(31635),i=n(96540),a=n(20978),o=n(90179),s=n.n(o),l=n(55364),u=n.n(l),c=n(62193),p=n.n(c),d=n(11331),h=n.n(d),f=n(8096),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={filename:""},t}return(0,r.C6)(t,e),t.prototype.componentDidUpdate=function(e){e.value===this.props.value||this.props.value||this.setState({filename:""})},t.prototype.syncAutoFill=function(e){var t=this.props,n=t.autoFill,r=t.onBulkChange,i=t.data,a=t.name;if(!(null==n?void 0:n.hasOwnProperty("api"))&&(0,f.Gvm)(n)){var o=a?s()(n,a):n;if(!p()(o)&&r){var l=(0,f.nd1)(o,{filename:e});Object.keys(l).forEach((function(e){h()(l[e])&&h()(i[e])&&(l[e]=u()({},i[e],l[e]))})),r(l)}}},t.prototype.handleDrop=function(e){var t=this,i=e[0],a=i.name,o=new FileReader;o.readAsArrayBuffer(i),o.onload=function(){return(0,r.sH)(t,void 0,void 0,(function(){var e=this;return(0,r.YH)(this,(function(t){return o.result&&(a.toLowerCase().endsWith(".xls")?n.e(3959).then(n.bind(n,3959)).then((function(t){var n=t.read(new Uint8Array(o.result),{cellDates:!0}),r=t.writeXLSX(n,{type:"array"});e.processExcelFile(r,a)})):this.processExcelFile(o.result,a)),[2]}))}))}},t.prototype.processExcelFile=function(e,t){var i=this,a=this.props,o=a.allSheets,s=a.onChange,l=a.parseImage,u=a.autoFill;n.e(4974).then(n.t.bind(n,24974,23)).then((function(n){return(0,r.sH)(i,void 0,void 0,(function(){var i,a,c,p,d,h,f=this;return(0,r.YH)(this,(function(r){switch(r.label){case 0:return i=n.default||n,this.ExcelJS=i,[4,(a=new i.Workbook).xlsx.load(e)];case 1:return r.sent(),c=[],o?a.eachSheet((function(e){"hidden"!==(e.state||"visible")&&(l?c.push({sheetName:e.name,data:f.readWorksheet(e),images:f.readImages(e,a)}):c.push({sheetName:e.name,data:f.readWorksheet(e)}))})):(p=a.worksheets.find((function(e){return"hidden"!==e.state})),l?(d=this.readImages(p,a),c={data:this.readWorksheet(p),images:d}):c=this.readWorksheet(p)),[4,this.dispatchEvent("change",c)];case 2:return(null==(h=r.sent())?void 0:h.prevented)||(s(c),u&&this.syncAutoFill(t),this.setState({filename:t})),[2]}}))}))}))},t.prototype.readImages=function(e,t){var n,i,a=this.props.imageDataURI,o=e.getImages(),s=[];try{for(var l=(0,r.Ju)(o),u=l.next();!u.done;u=l.next()){var c=u.value,p=t.getImage(+c.imageId),d=this.encodeBase64Bytes(p.buffer);if(a){var h=p.extension||"png";s.push("data:image/".concat(h,";base64,")+d)}else s.push(d)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}return s},t.prototype.encodeBase64Bytes=function(e){return btoa(e.reduce((function(e,t){return e+String.fromCharCode(t)}),""))},t.prototype.dispatchEvent=function(e,t){return(0,r.sH)(this,void 0,void 0,(function(){var n,i;return(0,r.YH)(this,(function(r){switch(r.label){case 0:return n=this.props,i=n.dispatchEvent,n.data,[4,i(e,(0,f.RKM)(this.props,{value:t}))];case 1:return[2,r.sent()]}}))}))},t.prototype.isRichTextValue=function(e){return!!(e&&(0,f.Gvm)(e)&&e.hasOwnProperty("richText")&&Array.isArray(null==e?void 0:e.richText))},t.prototype.richText2PlainString=function(e,t){return void 0===t&&(t=!1),e.richText.map((function(e){var n=e.text,r=e.font,i=void 0===r?{}:r,a=n;if(t){var o="",s=(null==i?void 0:i.bold)?"strong":(null==i?void 0:i.italic)?"em":"superscript"===(null==i?void 0:i.vertAlign)?"sup":"subscript"===(null==i?void 0:i.vertAlign)?"sub":"span";(null==i?void 0:i.strike)?o+="text-decoration: line-through;":(null==i?void 0:i.underline)&&(o+="text-decoration: underline;"),(null==i?void 0:i.outline)&&(o+="outline: solid;"),(null==i?void 0:i.size)&&(o+="font-size: ".concat(i.size,"px;")),a="<".concat(s," ").concat(o?"style=".concat(o):"",">").concat(n,"</").concat(s,">")}return a})).join("")},t.prototype.readWorksheet=function(e){var t=this,n=[],r=this.props,i=r.parseMode,a=r.plainText,o=r.includeEmpty;if("array"===i)return e.eachRow((function(e,r){var i=e.values;i.shift(),a&&(i=i.map((function(e){if(e instanceof Object){if(e.hyperlink)return e.hyperlink.startsWith("mailto:")?e.hyperlink.substring(7):e.hyperlink;if(e.result)return e.result;if(e.richText)return t.richText2PlainString(e)}return e}))),n.push(i)})),n;var s=[];return e.eachRow((function(e,r){var i;if(1==r)s=(null!==(i=e.values)&&void 0!==i?i:[]).map((function(e){return t.isRichTextValue(e)?t.richText2PlainString(e):e}));else{var l={};o&&s.forEach((function(e){l[e]=""})),e.eachCell((function(e,n){if(s[n]){var r=e.value;if(a){var i=t.ExcelJS.ValueType;e.type===i.Hyperlink?(r=e.value.hyperlink).startsWith("mailto:")&&(r=r.substring(7)):e.type===i.Formula?r=e.value.result:e.type===i.RichText?r=t.richText2PlainString(e.value):e.type===i.Error&&(r="")}l[s[n]]=r}})),n.push(l)}})),n},t.prototype.doAction=function(e,t,n){var r,i,a=null==e?void 0:e.actionType,o=this.props,s=o.onChange,l=o.resetValue,u=o.formStore,c=o.store,p=o.name;if("clear"===a)s("");else if("reset"===a){var d=null!==(i=(0,f.dnO)(null!==(r=null==u?void 0:u.pristine)&&void 0!==r?r:null==c?void 0:c.pristine,p))&&void 0!==i?i:l;s(null!=d?d:"")}},t.prototype.render=function(){var e=this,t=this.props,n=t.className,o=t.classnames;t.classPrefix;var s=t.disabled,l=t.translate,u=t.placeholder,c=t.testIdBuilder;return i.createElement("div",{className:o("ExcelControl",n)},i.createElement(a.Ay,{key:"drop-zone",onDrop:this.handleDrop,accept:".xlsx,.xls",multiple:!1,disabled:s},(function(t){var a=t.getRootProps,s=t.getInputProps;return i.createElement("section",{className:o("ExcelControl-container",n)},i.createElement("div",(0,r.Cl)({},a({className:o("ExcelControl-dropzone")}),null==c?void 0:c.getTestId()),i.createElement("input",(0,r.Cl)({},s(),null==c?void 0:c.getChild("input").getTestId())),e.state.filename?l("Excel.parsed",{filename:e.state.filename}):i.createElement("p",null,null!=u?u:l("Excel.placeholder"))))})))},t.defaultProps={allSheets:!1,parseMode:"object",includeEmpty:!0,plainText:!0,parseImage:!1,imageDataURI:!0},(0,r.Cg)([f.d6t,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[String]),(0,r.Sn)("design:returntype",void 0)],t.prototype,"syncAutoFill",null),(0,r.Cg)([f.d6t,(0,r.Sn)("design:type",Function),(0,r.Sn)("design:paramtypes",[Array]),(0,r.Sn)("design:returntype",void 0)],t.prototype,"handleDrop",null),t}(i.PureComponent),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.C6)(t,e),(0,r.Cg)([(0,f.eIh)({type:"input-excel"})],t)}(v)}}]);